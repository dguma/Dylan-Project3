{"ast":null,"code":"var Document = require('../document');\n\nvar PromiseProvider = require('../promise_provider');\n\nmodule.exports = Subdocument;\n/**\n * Subdocument constructor.\n *\n * @inherits Document\n * @api private\n */\n\nfunction Subdocument(value, fields, parent, skipId, options) {\n  this.$isSingleNested = true;\n  Document.call(this, value, fields, skipId, options);\n}\n\nSubdocument.prototype = Object.create(Document.prototype);\n\nSubdocument.prototype.toBSON = function () {\n  return this.toObject({\n    transform: false,\n    virtuals: false,\n    _skipDepopulateTopLevel: true,\n    depopulate: true,\n    flattenDecimals: false\n  });\n};\n/**\n * Used as a stub for [hooks.js](https://github.com/bnoguchi/hooks-js/tree/31ec571cef0332e21121ee7157e0cf9728572cc3)\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\n\nSubdocument.prototype.save = function (fn) {\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function (resolve) {\n    fn && fn();\n    resolve();\n  });\n};\n\nSubdocument.prototype.$isValid = function (path) {\n  if (this.$parent && this.$basePath) {\n    return this.$parent.$isValid([this.$basePath, path].join('.'));\n  }\n\n  return Document.prototype.$isValid.call(this, path);\n};\n\nSubdocument.prototype.markModified = function (path) {\n  Document.prototype.markModified.call(this, path);\n\n  if (this.$parent && this.$basePath) {\n    if (this.$parent.isDirectModified(this.$basePath)) {\n      return;\n    }\n\n    this.$parent.markModified([this.$basePath, path].join('.'), this);\n  }\n};\n\nSubdocument.prototype.$markValid = function (path) {\n  Document.prototype.$markValid.call(this, path);\n\n  if (this.$parent && this.$basePath) {\n    this.$parent.$markValid([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.invalidate = function (path, err, val) {\n  // Hack: array subdocuments' validationError is equal to the owner doc's,\n  // so validating an array subdoc gives the top-level doc back. Temporary\n  // workaround for #5208 so we don't have circular errors.\n  if (err !== this.ownerDocument().$__.validationError) {\n    Document.prototype.invalidate.call(this, path, err, val);\n  }\n\n  if (this.$parent && this.$basePath) {\n    this.$parent.invalidate([this.$basePath, path].join('.'), err, val);\n  } else if (err.kind === 'cast' || err.name === 'CastError') {\n    throw err;\n  }\n};\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\n\nSubdocument.prototype.ownerDocument = function () {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n\n  var parent = this.$parent;\n\n  if (!parent) {\n    return this;\n  }\n\n  while (parent.$parent || parent.__parent) {\n    parent = parent.$parent || parent.__parent;\n  }\n\n  this.$__.ownerDocument = parent;\n  return this.$__.ownerDocument;\n};\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n */\n\n\nSubdocument.prototype.parent = function () {\n  return this.$parent;\n};\n/**\n * Null-out this subdoc\n *\n * @param {Object} [options]\n * @param {Function} [callback] optional callback for compatibility with Document.prototype.remove\n */\n\n\nSubdocument.prototype.remove = function (options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  }\n\n  registerRemoveListener(this); // If removing entire doc, no need to remove subdoc\n\n  if (!options || !options.noop) {\n    this.$parent.set(this.$basePath, null);\n  }\n\n  if (typeof callback === 'function') {\n    callback(null);\n  }\n};\n/*!\n * ignore\n */\n\n\nSubdocument.prototype.populate = function () {\n  throw new Error('Mongoose does not support calling populate() on nested ' + 'docs. Instead of `doc.nested.populate(\"path\")`, use ' + '`doc.populate(\"nested.path\")`');\n};\n/*!\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {EmbeddedDocument} sub\n * @api private\n */\n\n\nfunction registerRemoveListener(sub) {\n  var owner = sub.ownerDocument();\n\n  function emitRemove() {\n    owner.removeListener('save', emitRemove);\n    owner.removeListener('remove', emitRemove);\n    sub.emit('remove', sub);\n    sub.constructor.emit('remove', sub);\n    owner = sub = null;\n  }\n\n  owner.on('save', emitRemove);\n  owner.on('remove', emitRemove);\n}","map":{"version":3,"sources":["/home/pumaguma/Desktop/project-draft/front/node_modules/mongoose/lib/types/subdocument.js"],"names":["Document","require","PromiseProvider","module","exports","Subdocument","value","fields","parent","skipId","options","$isSingleNested","call","prototype","Object","create","toBSON","toObject","transform","virtuals","_skipDepopulateTopLevel","depopulate","flattenDecimals","save","fn","Promise","get","ES6","resolve","$isValid","path","$parent","$basePath","join","markModified","isDirectModified","$markValid","invalidate","err","val","ownerDocument","$__","validationError","kind","name","__parent","remove","callback","registerRemoveListener","noop","set","populate","Error","sub","owner","emitRemove","removeListener","emit","constructor","on"],"mappings":"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","sourcesContent":["var Document = require('../document');\nvar PromiseProvider = require('../promise_provider');\n\nmodule.exports = Subdocument;\n\n/**\n * Subdocument constructor.\n *\n * @inherits Document\n * @api private\n */\n\nfunction Subdocument(value, fields, parent, skipId, options) {\n  this.$isSingleNested = true;\n  Document.call(this, value, fields, skipId, options);\n}\n\nSubdocument.prototype = Object.create(Document.prototype);\n\nSubdocument.prototype.toBSON = function() {\n  return this.toObject({\n    transform: false,\n    virtuals: false,\n    _skipDepopulateTopLevel: true,\n    depopulate: true,\n    flattenDecimals: false\n  });\n};\n\n/**\n * Used as a stub for [hooks.js](https://github.com/bnoguchi/hooks-js/tree/31ec571cef0332e21121ee7157e0cf9728572cc3)\n *\n * ####NOTE:\n *\n * _This is a no-op. Does not actually save the doc to the db._\n *\n * @param {Function} [fn]\n * @return {Promise} resolved Promise\n * @api private\n */\n\nSubdocument.prototype.save = function(fn) {\n  var Promise = PromiseProvider.get();\n  return new Promise.ES6(function(resolve) {\n    fn && fn();\n    resolve();\n  });\n};\n\nSubdocument.prototype.$isValid = function(path) {\n  if (this.$parent && this.$basePath) {\n    return this.$parent.$isValid([this.$basePath, path].join('.'));\n  }\n  return Document.prototype.$isValid.call(this, path);\n};\n\nSubdocument.prototype.markModified = function(path) {\n  Document.prototype.markModified.call(this, path);\n  if (this.$parent && this.$basePath) {\n    if (this.$parent.isDirectModified(this.$basePath)) {\n      return;\n    }\n    this.$parent.markModified([this.$basePath, path].join('.'), this);\n  }\n};\n\nSubdocument.prototype.$markValid = function(path) {\n  Document.prototype.$markValid.call(this, path);\n  if (this.$parent && this.$basePath) {\n    this.$parent.$markValid([this.$basePath, path].join('.'));\n  }\n};\n\nSubdocument.prototype.invalidate = function(path, err, val) {\n  // Hack: array subdocuments' validationError is equal to the owner doc's,\n  // so validating an array subdoc gives the top-level doc back. Temporary\n  // workaround for #5208 so we don't have circular errors.\n  if (err !== this.ownerDocument().$__.validationError) {\n    Document.prototype.invalidate.call(this, path, err, val);\n  }\n\n  if (this.$parent && this.$basePath) {\n    this.$parent.invalidate([this.$basePath, path].join('.'), err, val);\n  } else if (err.kind === 'cast' || err.name === 'CastError') {\n    throw err;\n  }\n};\n\n/**\n * Returns the top level document of this sub-document.\n *\n * @return {Document}\n */\n\nSubdocument.prototype.ownerDocument = function() {\n  if (this.$__.ownerDocument) {\n    return this.$__.ownerDocument;\n  }\n\n  var parent = this.$parent;\n  if (!parent) {\n    return this;\n  }\n\n  while (parent.$parent || parent.__parent) {\n    parent = parent.$parent || parent.__parent;\n  }\n  this.$__.ownerDocument = parent;\n  return this.$__.ownerDocument;\n};\n\n/**\n * Returns this sub-documents parent document.\n *\n * @api public\n */\n\nSubdocument.prototype.parent = function() {\n  return this.$parent;\n};\n\n/**\n * Null-out this subdoc\n *\n * @param {Object} [options]\n * @param {Function} [callback] optional callback for compatibility with Document.prototype.remove\n */\n\nSubdocument.prototype.remove = function(options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = null;\n  }\n\n  registerRemoveListener(this);\n\n  // If removing entire doc, no need to remove subdoc\n  if (!options || !options.noop) {\n    this.$parent.set(this.$basePath, null);\n  }\n\n  if (typeof callback === 'function') {\n    callback(null);\n  }\n};\n\n/*!\n * ignore\n */\n\nSubdocument.prototype.populate = function() {\n  throw new Error('Mongoose does not support calling populate() on nested ' +\n    'docs. Instead of `doc.nested.populate(\"path\")`, use ' +\n    '`doc.populate(\"nested.path\")`');\n};\n\n/*!\n * Registers remove event listeners for triggering\n * on subdocuments.\n *\n * @param {EmbeddedDocument} sub\n * @api private\n */\n\nfunction registerRemoveListener(sub) {\n  var owner = sub.ownerDocument();\n\n  function emitRemove() {\n    owner.removeListener('save', emitRemove);\n    owner.removeListener('remove', emitRemove);\n    sub.emit('remove', sub);\n    sub.constructor.emit('remove', sub);\n    owner = sub = null;\n  }\n\n  owner.on('save', emitRemove);\n  owner.on('remove', emitRemove);\n}\n"]},"metadata":{},"sourceType":"script"}