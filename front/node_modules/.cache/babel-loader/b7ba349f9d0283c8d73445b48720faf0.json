{"ast":null,"code":"/*!\n * Module dependencies.\n */\nvar Decimal = require('./types/decimal128');\n\nvar ObjectId = require('./types/objectid');\n\nvar cloneRegExp = require('regexp-clone');\n\nvar sliced = require('sliced');\n\nvar mpath = require('mpath');\n\nvar ms = require('ms');\n\nvar MongooseBuffer;\nvar MongooseArray;\nvar Document;\n/*!\n * Produces a collection name from model `name`.\n *\n * @param {String} name a model name\n * @return {String} a collection name\n * @api private\n */\n\nexports.toCollectionName = function (name, options) {\n  options = options || {};\n\n  if (name === 'system.profile') {\n    return name;\n  }\n\n  if (name === 'system.indexes') {\n    return name;\n  }\n\n  if (options.pluralization === false) {\n    return name;\n  }\n\n  return pluralize(name.toLowerCase());\n};\n/**\n * Pluralization rules.\n *\n * These rules are applied while processing the argument to `toCollectionName`.\n *\n * @deprecated remove in 4.x gh-1350\n */\n\n\nexports.pluralization = [[/(m)an$/gi, '$1en'], [/(pe)rson$/gi, '$1ople'], [/(child)$/gi, '$1ren'], [/^(ox)$/gi, '$1en'], [/(ax|test)is$/gi, '$1es'], [/(octop|vir)us$/gi, '$1i'], [/(alias|status)$/gi, '$1es'], [/(bu)s$/gi, '$1ses'], [/(buffal|tomat|potat)o$/gi, '$1oes'], [/([ti])um$/gi, '$1a'], [/sis$/gi, 'ses'], [/(?:([^f])fe|([lr])f)$/gi, '$1$2ves'], [/(hive)$/gi, '$1s'], [/([^aeiouy]|qu)y$/gi, '$1ies'], [/(x|ch|ss|sh)$/gi, '$1es'], [/(matr|vert|ind)ix|ex$/gi, '$1ices'], [/([m|l])ouse$/gi, '$1ice'], [/(kn|w|l)ife$/gi, '$1ives'], [/(quiz)$/gi, '$1zes'], [/s$/gi, 's'], [/([^a-z])$/, '$1'], [/$/gi, 's']];\nvar rules = exports.pluralization;\n/**\n * Uncountable words.\n *\n * These words are applied while processing the argument to `toCollectionName`.\n * @api public\n */\n\nexports.uncountables = ['advice', 'energy', 'excretion', 'digestion', 'cooperation', 'health', 'justice', 'labour', 'machinery', 'equipment', 'information', 'pollution', 'sewage', 'paper', 'money', 'species', 'series', 'rain', 'rice', 'fish', 'sheep', 'moose', 'deer', 'news', 'expertise', 'status', 'media'];\nvar uncountables = exports.uncountables;\n/*!\n * Pluralize function.\n *\n * @author TJ Holowaychuk (extracted from _ext.js_)\n * @param {String} string to pluralize\n * @api private\n */\n\nfunction pluralize(str) {\n  var found;\n\n  if (!~uncountables.indexOf(str.toLowerCase())) {\n    found = rules.filter(function (rule) {\n      return str.match(rule[0]);\n    });\n\n    if (found[0]) {\n      return str.replace(found[0][0], found[0][1]);\n    }\n  }\n\n  return str;\n}\n/*!\n * Determines if `a` and `b` are deep equal.\n *\n * Modified from node/lib/assert.js\n *\n * @param {any} a a value to compare to `b`\n * @param {any} b a value to compare to `a`\n * @return {Boolean}\n * @api private\n */\n\n\nexports.deepEqual = function deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a instanceof Date && b instanceof Date) {\n    return a.getTime() === b.getTime();\n  }\n\n  if (a instanceof ObjectId && b instanceof ObjectId || a instanceof Decimal && b instanceof Decimal) {\n    return a.toString() === b.toString();\n  }\n\n  if (a instanceof RegExp && b instanceof RegExp) {\n    return a.source === b.source && a.ignoreCase === b.ignoreCase && a.multiline === b.multiline && a.global === b.global;\n  }\n\n  if (typeof a !== 'object' && typeof b !== 'object') {\n    return a == b;\n  }\n\n  if (a === null || b === null || a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (a.prototype !== b.prototype) {\n    return false;\n  } // Handle MongooseNumbers\n\n\n  if (a instanceof Number && b instanceof Number) {\n    return a.valueOf() === b.valueOf();\n  }\n\n  if (Buffer.isBuffer(a)) {\n    return exports.buffer.areEqual(a, b);\n  }\n\n  if (isMongooseObject(a)) {\n    a = a.toObject();\n  }\n\n  if (isMongooseObject(b)) {\n    b = b.toObject();\n  }\n\n  try {\n    var ka = Object.keys(a),\n        kb = Object.keys(b),\n        key,\n        i;\n  } catch (e) {\n    // happens when one is a string literal and the other isn't\n    return false;\n  } // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n\n\n  if (ka.length !== kb.length) {\n    return false;\n  } // the same set of keys (although not necessarily the same order),\n\n\n  ka.sort();\n  kb.sort(); // ~~~cheap key test\n\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i]) {\n      return false;\n    }\n  } // equivalent values for every corresponding key, and\n  // ~~~possibly expensive deep test\n\n\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n\n    if (!deepEqual(a[key], b[key])) {\n      return false;\n    }\n  }\n\n  return true;\n};\n/*!\n * Object clone with Mongoose natives support.\n *\n * If options.minimize is true, creates a minimal data object. Empty objects and undefined values will not be cloned. This makes the data payload sent to MongoDB as small as possible.\n *\n * Functions are never cloned.\n *\n * @param {Object} obj the object to clone\n * @param {Object} options\n * @return {Object} the cloned object\n * @api private\n */\n\n\nexports.clone = function clone(obj, options) {\n  if (obj === undefined || obj === null) {\n    return obj;\n  }\n\n  if (Array.isArray(obj)) {\n    return cloneArray(obj, options);\n  }\n\n  if (isMongooseObject(obj)) {\n    if (options && options.json && typeof obj.toJSON === 'function') {\n      return obj.toJSON(options);\n    }\n\n    return obj.toObject(options);\n  }\n\n  if (obj.constructor) {\n    switch (exports.getFunctionName(obj.constructor)) {\n      case 'Object':\n        return cloneObject(obj, options);\n\n      case 'Date':\n        return new obj.constructor(+obj);\n\n      case 'RegExp':\n        return cloneRegExp(obj);\n\n      default:\n        // ignore\n        break;\n    }\n  }\n\n  if (obj instanceof ObjectId) {\n    return new ObjectId(obj.id);\n  }\n\n  if (obj instanceof Decimal) {\n    if (options && options.flattenDecimals) {\n      return obj.toJSON();\n    }\n\n    return Decimal.fromString(obj.toString());\n  }\n\n  if (!obj.constructor && exports.isObject(obj)) {\n    // object created with Object.create(null)\n    return cloneObject(obj, options);\n  }\n\n  if (obj.valueOf) {\n    return obj.valueOf();\n  }\n};\n\nvar clone = exports.clone;\n/*!\n * TODO: replace with Object.assign() in 5.0\n */\n\nexports.assign = function (target) {\n  for (var i = 1; i < arguments.length; ++i) {\n    var nextSource = arguments[i];\n\n    if (nextSource != null) {\n      for (var nextKey in nextSource) {\n        if (nextSource.hasOwnProperty(nextKey)) {\n          target[nextKey] = nextSource[nextKey];\n        }\n      }\n    }\n  }\n\n  return target;\n};\n/*!\n * ignore\n */\n\n\nfunction cloneObject(obj, options) {\n  var retainKeyOrder = options && options.retainKeyOrder,\n      minimize = options && options.minimize,\n      ret = {},\n      hasKeys,\n      keys,\n      val,\n      k,\n      i;\n\n  if (retainKeyOrder) {\n    for (k in obj) {\n      val = clone(obj[k], options);\n\n      if (!minimize || typeof val !== 'undefined') {\n        hasKeys || (hasKeys = true);\n        ret[k] = val;\n      }\n    }\n  } else {\n    // faster\n    keys = Object.keys(obj);\n    i = keys.length;\n\n    while (i--) {\n      k = keys[i];\n      val = clone(obj[k], options);\n\n      if (!minimize || typeof val !== 'undefined') {\n        if (!hasKeys) {\n          hasKeys = true;\n        }\n\n        ret[k] = val;\n      }\n    }\n  }\n\n  return minimize ? hasKeys && ret : ret;\n}\n\nfunction cloneArray(arr, options) {\n  var ret = [];\n\n  for (var i = 0, l = arr.length; i < l; i++) {\n    ret.push(clone(arr[i], options));\n  }\n\n  return ret;\n}\n/*!\n * Shallow copies defaults into options.\n *\n * @param {Object} defaults\n * @param {Object} options\n * @return {Object} the merged object\n * @api private\n */\n\n\nexports.options = function (defaults, options) {\n  var keys = Object.keys(defaults),\n      i = keys.length,\n      k;\n  options = options || {};\n\n  while (i--) {\n    k = keys[i];\n\n    if (!(k in options)) {\n      options[k] = defaults[k];\n    }\n  }\n\n  return options;\n};\n/*!\n * Generates a random string\n *\n * @api private\n */\n\n\nexports.random = function () {\n  return Math.random().toString().substr(3);\n};\n/*!\n * Merges `from` into `to` without overwriting existing properties.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\n\nexports.merge = function merge(to, from, options) {\n  options = options || {};\n  var keys = Object.keys(from);\n  var i = 0;\n  var len = keys.length;\n  var key;\n\n  if (options.retainKeyOrder) {\n    while (i < len) {\n      key = keys[i++];\n\n      if (options.omit && options.omit[key]) {\n        continue;\n      }\n\n      if (to[key] == null) {\n        to[key] = from[key];\n      } else if (exports.isObject(from[key])) {\n        merge(to[key], from[key], options);\n      } else if (options.overwrite) {\n        to[key] = from[key];\n      }\n    }\n  } else {\n    while (len--) {\n      key = keys[len];\n\n      if (options.omit && options.omit[key]) {\n        continue;\n      }\n\n      if (to[key] == null) {\n        to[key] = from[key];\n      } else if (exports.isObject(from[key])) {\n        merge(to[key], from[key], options);\n      } else if (options.overwrite) {\n        to[key] = from[key];\n      }\n    }\n  }\n};\n/*!\n * Applies toObject recursively.\n *\n * @param {Document|Array|Object} obj\n * @return {Object}\n * @api private\n */\n\n\nexports.toObject = function toObject(obj) {\n  Document || (Document = require('./document'));\n  var ret;\n\n  if (exports.isNullOrUndefined(obj)) {\n    return obj;\n  }\n\n  if (obj instanceof Document) {\n    return obj.toObject();\n  }\n\n  if (Array.isArray(obj)) {\n    ret = [];\n\n    for (var i = 0, len = obj.length; i < len; ++i) {\n      ret.push(toObject(obj[i]));\n    }\n\n    return ret;\n  }\n\n  if (obj.constructor && exports.getFunctionName(obj.constructor) === 'Object' || !obj.constructor && exports.isObject(obj)) {\n    ret = {};\n\n    for (var k in obj) {\n      ret[k] = toObject(obj[k]);\n    }\n\n    return ret;\n  }\n\n  return obj;\n};\n/*!\n * Determines if `arg` is an object.\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @api private\n * @return {Boolean}\n */\n\n\nexports.isObject = function (arg) {\n  if (Buffer.isBuffer(arg)) {\n    return true;\n  }\n\n  return Object.prototype.toString.call(arg) === '[object Object]';\n};\n/*!\n * A faster Array.prototype.slice.call(arguments) alternative\n * @api private\n */\n\n\nexports.args = sliced;\n/*!\n * process.nextTick helper.\n *\n * Wraps `callback` in a try/catch + nextTick.\n *\n * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.\n *\n * @param {Function} callback\n * @api private\n */\n\nexports.tick = function tick(callback) {\n  if (typeof callback !== 'function') {\n    return;\n  }\n\n  return function () {\n    try {\n      callback.apply(this, arguments);\n    } catch (err) {\n      // only nextTick on err to get out of\n      // the event loop and avoid state corruption.\n      process.nextTick(function () {\n        throw err;\n      });\n    }\n  };\n};\n/*!\n * Returns if `v` is a mongoose object that has a `toObject()` method we can use.\n *\n * This is for compatibility with libs like Date.js which do foolish things to Natives.\n *\n * @param {any} v\n * @api private\n */\n\n\nexports.isMongooseObject = function (v) {\n  Document || (Document = require('./document'));\n  MongooseArray || (MongooseArray = require('./types').Array);\n  MongooseBuffer || (MongooseBuffer = require('./types').Buffer);\n  return v instanceof Document || v && v.isMongooseArray || v && v.isMongooseBuffer;\n};\n\nvar isMongooseObject = exports.isMongooseObject;\n/*!\n * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.\n *\n * @param {Object} object\n * @api private\n */\n\nexports.expires = function expires(object) {\n  if (!(object && object.constructor.name === 'Object')) {\n    return;\n  }\n\n  if (!('expires' in object)) {\n    return;\n  }\n\n  var when;\n\n  if (typeof object.expires !== 'string') {\n    when = object.expires;\n  } else {\n    when = Math.round(ms(object.expires) / 1000);\n  }\n\n  object.expireAfterSeconds = when;\n  delete object.expires;\n};\n/*!\n * Populate options constructor\n */\n\n\nfunction PopulateOptions(path, select, match, options, model, subPopulate) {\n  this.path = path;\n  this.match = match;\n  this.select = select;\n  this.options = options;\n  this.model = model;\n\n  if (typeof subPopulate === 'object') {\n    this.populate = subPopulate;\n  }\n\n  this._docs = {};\n} // make it compatible with utils.clone\n\n\nPopulateOptions.prototype.constructor = Object; // expose\n\nexports.PopulateOptions = PopulateOptions;\n/*!\n * populate helper\n */\n\nexports.populate = function populate(path, select, model, match, options, subPopulate) {\n  // The order of select/conditions args is opposite Model.find but\n  // necessary to keep backward compatibility (select could be\n  // an array, string, or object literal).\n  // might have passed an object specifying all arguments\n  if (arguments.length === 1) {\n    if (path instanceof PopulateOptions) {\n      return [path];\n    }\n\n    if (Array.isArray(path)) {\n      return path.map(function (o) {\n        return exports.populate(o)[0];\n      });\n    }\n\n    if (exports.isObject(path)) {\n      match = path.match;\n      options = path.options;\n      select = path.select;\n      model = path.model;\n      subPopulate = path.populate;\n      path = path.path;\n    }\n  } else if (typeof model !== 'string' && typeof model !== 'function') {\n    options = match;\n    match = model;\n    model = undefined;\n  }\n\n  if (typeof path !== 'string') {\n    throw new TypeError('utils.populate: invalid path. Expected string. Got typeof `' + typeof path + '`');\n  }\n\n  if (typeof subPopulate === 'object') {\n    subPopulate = exports.populate(subPopulate);\n  }\n\n  var ret = [];\n  var paths = path.split(' ');\n  options = exports.clone(options, {\n    retainKeyOrder: true\n  });\n\n  for (var i = 0; i < paths.length; ++i) {\n    ret.push(new PopulateOptions(paths[i], select, match, options, model, subPopulate));\n  }\n\n  return ret;\n};\n/*!\n * Return the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Object} obj\n */\n\n\nexports.getValue = function (path, obj, map) {\n  return mpath.get(path, obj, '_doc', map);\n};\n/*!\n * Sets the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Anything} val\n * @param {Object} obj\n */\n\n\nexports.setValue = function (path, val, obj, map) {\n  mpath.set(path, val, obj, '_doc', map);\n};\n/*!\n * Returns an array of values from object `o`.\n *\n * @param {Object} o\n * @return {Array}\n * @private\n */\n\n\nexports.object = {};\n\nexports.object.vals = function vals(o) {\n  var keys = Object.keys(o),\n      i = keys.length,\n      ret = [];\n\n  while (i--) {\n    ret.push(o[keys[i]]);\n  }\n\n  return ret;\n};\n/*!\n * @see exports.options\n */\n\n\nexports.object.shallowCopy = exports.options;\n/*!\n * Safer helper for hasOwnProperty checks\n *\n * @param {Object} obj\n * @param {String} prop\n */\n\nvar hop = Object.prototype.hasOwnProperty;\n\nexports.object.hasOwnProperty = function (obj, prop) {\n  return hop.call(obj, prop);\n};\n/*!\n * Determine if `val` is null or undefined\n *\n * @return {Boolean}\n */\n\n\nexports.isNullOrUndefined = function (val) {\n  return val === null || val === undefined;\n};\n/*!\n * ignore\n */\n\n\nexports.array = {};\n/*!\n * Flattens an array.\n *\n * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]\n *\n * @param {Array} arr\n * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsey value, the item will not be included in the results.\n * @return {Array}\n * @private\n */\n\nexports.array.flatten = function flatten(arr, filter, ret) {\n  ret || (ret = []);\n  arr.forEach(function (item) {\n    if (Array.isArray(item)) {\n      flatten(item, filter, ret);\n    } else {\n      if (!filter || filter(item)) {\n        ret.push(item);\n      }\n    }\n  });\n  return ret;\n};\n/*!\n * Removes duplicate values from an array\n *\n * [1, 2, 3, 3, 5] => [1, 2, 3, 5]\n * [ ObjectId(\"550988ba0c19d57f697dc45e\"), ObjectId(\"550988ba0c19d57f697dc45e\") ]\n *    => [ObjectId(\"550988ba0c19d57f697dc45e\")]\n *\n * @param {Array} arr\n * @return {Array}\n * @private\n */\n\n\nexports.array.unique = function (arr) {\n  var primitives = {};\n  var ids = {};\n  var ret = [];\n  var length = arr.length;\n\n  for (var i = 0; i < length; ++i) {\n    if (typeof arr[i] === 'number' || typeof arr[i] === 'string') {\n      if (primitives[arr[i]]) {\n        continue;\n      }\n\n      ret.push(arr[i]);\n      primitives[arr[i]] = true;\n    } else if (arr[i] instanceof ObjectId) {\n      if (ids[arr[i].toString()]) {\n        continue;\n      }\n\n      ret.push(arr[i]);\n      ids[arr[i].toString()] = true;\n    } else {\n      ret.push(arr[i]);\n    }\n  }\n\n  return ret;\n};\n/*!\n * Determines if two buffers are equal.\n *\n * @param {Buffer} a\n * @param {Object} b\n */\n\n\nexports.buffer = {};\n\nexports.buffer.areEqual = function (a, b) {\n  if (!Buffer.isBuffer(a)) {\n    return false;\n  }\n\n  if (!Buffer.isBuffer(b)) {\n    return false;\n  }\n\n  if (a.length !== b.length) {\n    return false;\n  }\n\n  for (var i = 0, len = a.length; i < len; ++i) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nexports.getFunctionName = function (fn) {\n  if (fn.name) {\n    return fn.name;\n  }\n\n  return (fn.toString().trim().match(/^function\\s*([^\\s(]+)/) || [])[1];\n};\n\nexports.decorate = function (destination, source) {\n  for (var key in source) {\n    destination[key] = source[key];\n  }\n};\n/**\n * merges to with a copy of from\n *\n * @param {Object} to\n * @param {Object} fromObj\n * @api private\n */\n\n\nexports.mergeClone = function (to, fromObj) {\n  var keys = Object.keys(fromObj);\n  var len = keys.length;\n  var i = 0;\n  var key;\n\n  while (i < len) {\n    key = keys[i++];\n\n    if (typeof to[key] === 'undefined') {\n      // make sure to retain key order here because of a bug handling the $each\n      // operator in mongodb 2.4.4\n      to[key] = exports.clone(fromObj[key], {\n        retainKeyOrder: 1,\n        flattenDecimals: false\n      });\n    } else {\n      if (exports.isObject(fromObj[key])) {\n        var obj = fromObj[key];\n\n        if (isMongooseObject(fromObj[key]) && !fromObj[key].isMongooseBuffer) {\n          obj = obj.toObject({\n            transform: false,\n            virtuals: false\n          });\n        }\n\n        if (fromObj[key].isMongooseBuffer) {\n          obj = new Buffer(obj);\n        }\n\n        exports.mergeClone(to[key], obj);\n      } else {\n        // make sure to retain key order here because of a bug handling the\n        // $each operator in mongodb 2.4.4\n        to[key] = exports.clone(fromObj[key], {\n          retainKeyOrder: 1,\n          flattenDecimals: false\n        });\n      }\n    }\n  }\n};\n/**\n * Executes a function on each element of an array (like _.each)\n *\n * @param {Array} arr\n * @param {Function} fn\n * @api private\n */\n\n\nexports.each = function (arr, fn) {\n  for (var i = 0; i < arr.length; ++i) {\n    fn(arr[i]);\n  }\n};\n/*!\n * ignore\n */\n\n\nexports.noop = function () {};","map":{"version":3,"sources":["/home/pumaguma/Desktop/project-draft/front/node_modules/mongoose/lib/utils.js"],"names":["Decimal","require","ObjectId","cloneRegExp","sliced","mpath","ms","MongooseBuffer","MongooseArray","Document","exports","toCollectionName","name","options","pluralization","pluralize","toLowerCase","rules","uncountables","str","found","indexOf","filter","rule","match","replace","deepEqual","a","b","Date","getTime","toString","RegExp","source","ignoreCase","multiline","global","undefined","prototype","Number","valueOf","Buffer","isBuffer","buffer","areEqual","isMongooseObject","toObject","ka","Object","keys","kb","key","i","e","length","sort","clone","obj","Array","isArray","cloneArray","json","toJSON","constructor","getFunctionName","cloneObject","id","flattenDecimals","fromString","isObject","assign","target","arguments","nextSource","nextKey","hasOwnProperty","retainKeyOrder","minimize","ret","hasKeys","val","k","arr","l","push","defaults","random","Math","substr","merge","to","from","len","omit","overwrite","isNullOrUndefined","arg","call","args","tick","callback","apply","err","process","nextTick","v","isMongooseArray","isMongooseBuffer","expires","object","when","round","expireAfterSeconds","PopulateOptions","path","select","model","subPopulate","populate","_docs","map","o","TypeError","paths","split","getValue","get","setValue","set","vals","shallowCopy","hop","prop","array","flatten","forEach","item","unique","primitives","ids","fn","trim","decorate","destination","mergeClone","fromObj","transform","virtuals","each","noop"],"mappings":"AAAA;AACA;AACA;AAEA,IAAIA,OAAO,GAAGC,OAAO,CAAC,oBAAD,CAArB;;AACA,IAAIC,QAAQ,GAAGD,OAAO,CAAC,kBAAD,CAAtB;;AACA,IAAIE,WAAW,GAAGF,OAAO,CAAC,cAAD,CAAzB;;AACA,IAAIG,MAAM,GAAGH,OAAO,CAAC,QAAD,CAApB;;AACA,IAAII,KAAK,GAAGJ,OAAO,CAAC,OAAD,CAAnB;;AACA,IAAIK,EAAE,GAAGL,OAAO,CAAC,IAAD,CAAhB;;AACA,IAAIM,cAAJ;AACA,IAAIC,aAAJ;AACA,IAAIC,QAAJ;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAC,OAAO,CAACC,gBAAR,GAA2B,UAASC,IAAT,EAAeC,OAAf,EAAwB;AACjDA,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;;AACA,MAAID,IAAI,KAAK,gBAAb,EAA+B;AAC7B,WAAOA,IAAP;AACD;;AACD,MAAIA,IAAI,KAAK,gBAAb,EAA+B;AAC7B,WAAOA,IAAP;AACD;;AACD,MAAIC,OAAO,CAACC,aAAR,KAA0B,KAA9B,EAAqC;AACnC,WAAOF,IAAP;AACD;;AACD,SAAOG,SAAS,CAACH,IAAI,CAACI,WAAL,EAAD,CAAhB;AACD,CAZD;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAN,OAAO,CAACI,aAAR,GAAwB,CACtB,CAAC,UAAD,EAAa,MAAb,CADsB,EAEtB,CAAC,aAAD,EAAgB,QAAhB,CAFsB,EAGtB,CAAC,YAAD,EAAe,OAAf,CAHsB,EAItB,CAAC,UAAD,EAAa,MAAb,CAJsB,EAKtB,CAAC,gBAAD,EAAmB,MAAnB,CALsB,EAMtB,CAAC,kBAAD,EAAqB,KAArB,CANsB,EAOtB,CAAC,mBAAD,EAAsB,MAAtB,CAPsB,EAQtB,CAAC,UAAD,EAAa,OAAb,CARsB,EAStB,CAAC,0BAAD,EAA6B,OAA7B,CATsB,EAUtB,CAAC,aAAD,EAAgB,KAAhB,CAVsB,EAWtB,CAAC,QAAD,EAAW,KAAX,CAXsB,EAYtB,CAAC,yBAAD,EAA4B,SAA5B,CAZsB,EAatB,CAAC,WAAD,EAAc,KAAd,CAbsB,EActB,CAAC,oBAAD,EAAuB,OAAvB,CAdsB,EAetB,CAAC,iBAAD,EAAoB,MAApB,CAfsB,EAgBtB,CAAC,yBAAD,EAA4B,QAA5B,CAhBsB,EAiBtB,CAAC,gBAAD,EAAmB,OAAnB,CAjBsB,EAkBtB,CAAC,gBAAD,EAAmB,QAAnB,CAlBsB,EAmBtB,CAAC,WAAD,EAAc,OAAd,CAnBsB,EAoBtB,CAAC,MAAD,EAAS,GAAT,CApBsB,EAqBtB,CAAC,WAAD,EAAc,IAAd,CArBsB,EAsBtB,CAAC,KAAD,EAAQ,GAAR,CAtBsB,CAAxB;AAwBA,IAAIG,KAAK,GAAGP,OAAO,CAACI,aAApB;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEAJ,OAAO,CAACQ,YAAR,GAAuB,CACrB,QADqB,EAErB,QAFqB,EAGrB,WAHqB,EAIrB,WAJqB,EAKrB,aALqB,EAMrB,QANqB,EAOrB,SAPqB,EAQrB,QARqB,EASrB,WATqB,EAUrB,WAVqB,EAWrB,aAXqB,EAYrB,WAZqB,EAarB,QAbqB,EAcrB,OAdqB,EAerB,OAfqB,EAgBrB,SAhBqB,EAiBrB,QAjBqB,EAkBrB,MAlBqB,EAmBrB,MAnBqB,EAoBrB,MApBqB,EAqBrB,OArBqB,EAsBrB,OAtBqB,EAuBrB,MAvBqB,EAwBrB,MAxBqB,EAyBrB,WAzBqB,EA0BrB,QA1BqB,EA2BrB,OA3BqB,CAAvB;AA6BA,IAAIA,YAAY,GAAGR,OAAO,CAACQ,YAA3B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASH,SAAT,CAAmBI,GAAnB,EAAwB;AACtB,MAAIC,KAAJ;;AACA,MAAI,CAAC,CAACF,YAAY,CAACG,OAAb,CAAqBF,GAAG,CAACH,WAAJ,EAArB,CAAN,EAA+C;AAC7CI,IAAAA,KAAK,GAAGH,KAAK,CAACK,MAAN,CAAa,UAASC,IAAT,EAAe;AAClC,aAAOJ,GAAG,CAACK,KAAJ,CAAUD,IAAI,CAAC,CAAD,CAAd,CAAP;AACD,KAFO,CAAR;;AAGA,QAAIH,KAAK,CAAC,CAAD,CAAT,EAAc;AACZ,aAAOD,GAAG,CAACM,OAAJ,CAAYL,KAAK,CAAC,CAAD,CAAL,CAAS,CAAT,CAAZ,EAAyBA,KAAK,CAAC,CAAD,CAAL,CAAS,CAAT,CAAzB,CAAP;AACD;AACF;;AACD,SAAOD,GAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAT,OAAO,CAACgB,SAAR,GAAoB,SAASA,SAAT,CAAmBC,CAAnB,EAAsBC,CAAtB,EAAyB;AAC3C,MAAID,CAAC,KAAKC,CAAV,EAAa;AACX,WAAO,IAAP;AACD;;AAED,MAAID,CAAC,YAAYE,IAAb,IAAqBD,CAAC,YAAYC,IAAtC,EAA4C;AAC1C,WAAOF,CAAC,CAACG,OAAF,OAAgBF,CAAC,CAACE,OAAF,EAAvB;AACD;;AAED,MAAKH,CAAC,YAAYzB,QAAb,IAAyB0B,CAAC,YAAY1B,QAAvC,IACCyB,CAAC,YAAY3B,OAAb,IAAwB4B,CAAC,YAAY5B,OAD1C,EACoD;AAClD,WAAO2B,CAAC,CAACI,QAAF,OAAiBH,CAAC,CAACG,QAAF,EAAxB;AACD;;AAED,MAAIJ,CAAC,YAAYK,MAAb,IAAuBJ,CAAC,YAAYI,MAAxC,EAAgD;AAC9C,WAAOL,CAAC,CAACM,MAAF,KAAaL,CAAC,CAACK,MAAf,IACHN,CAAC,CAACO,UAAF,KAAiBN,CAAC,CAACM,UADhB,IAEHP,CAAC,CAACQ,SAAF,KAAgBP,CAAC,CAACO,SAFf,IAGHR,CAAC,CAACS,MAAF,KAAaR,CAAC,CAACQ,MAHnB;AAID;;AAED,MAAI,OAAOT,CAAP,KAAa,QAAb,IAAyB,OAAOC,CAAP,KAAa,QAA1C,EAAoD;AAClD,WAAOD,CAAC,IAAIC,CAAZ;AACD;;AAED,MAAID,CAAC,KAAK,IAAN,IAAcC,CAAC,KAAK,IAApB,IAA4BD,CAAC,KAAKU,SAAlC,IAA+CT,CAAC,KAAKS,SAAzD,EAAoE;AAClE,WAAO,KAAP;AACD;;AAED,MAAIV,CAAC,CAACW,SAAF,KAAgBV,CAAC,CAACU,SAAtB,EAAiC;AAC/B,WAAO,KAAP;AACD,GA/B0C,CAiC3C;;;AACA,MAAIX,CAAC,YAAYY,MAAb,IAAuBX,CAAC,YAAYW,MAAxC,EAAgD;AAC9C,WAAOZ,CAAC,CAACa,OAAF,OAAgBZ,CAAC,CAACY,OAAF,EAAvB;AACD;;AAED,MAAIC,MAAM,CAACC,QAAP,CAAgBf,CAAhB,CAAJ,EAAwB;AACtB,WAAOjB,OAAO,CAACiC,MAAR,CAAeC,QAAf,CAAwBjB,CAAxB,EAA2BC,CAA3B,CAAP;AACD;;AAED,MAAIiB,gBAAgB,CAAClB,CAAD,CAApB,EAAyB;AACvBA,IAAAA,CAAC,GAAGA,CAAC,CAACmB,QAAF,EAAJ;AACD;;AACD,MAAID,gBAAgB,CAACjB,CAAD,CAApB,EAAyB;AACvBA,IAAAA,CAAC,GAAGA,CAAC,CAACkB,QAAF,EAAJ;AACD;;AAED,MAAI;AACF,QAAIC,EAAE,GAAGC,MAAM,CAACC,IAAP,CAAYtB,CAAZ,CAAT;AAAA,QACIuB,EAAE,GAAGF,MAAM,CAACC,IAAP,CAAYrB,CAAZ,CADT;AAAA,QAEIuB,GAFJ;AAAA,QAESC,CAFT;AAGD,GAJD,CAIE,OAAOC,CAAP,EAAU;AACV;AACA,WAAO,KAAP;AACD,GAxD0C,CA0D3C;AACA;;;AACA,MAAIN,EAAE,CAACO,MAAH,KAAcJ,EAAE,CAACI,MAArB,EAA6B;AAC3B,WAAO,KAAP;AACD,GA9D0C,CAgE3C;;;AACAP,EAAAA,EAAE,CAACQ,IAAH;AACAL,EAAAA,EAAE,CAACK,IAAH,GAlE2C,CAoE3C;;AACA,OAAKH,CAAC,GAAGL,EAAE,CAACO,MAAH,GAAY,CAArB,EAAwBF,CAAC,IAAI,CAA7B,EAAgCA,CAAC,EAAjC,EAAqC;AACnC,QAAIL,EAAE,CAACK,CAAD,CAAF,KAAUF,EAAE,CAACE,CAAD,CAAhB,EAAqB;AACnB,aAAO,KAAP;AACD;AACF,GAzE0C,CA2E3C;AACA;;;AACA,OAAKA,CAAC,GAAGL,EAAE,CAACO,MAAH,GAAY,CAArB,EAAwBF,CAAC,IAAI,CAA7B,EAAgCA,CAAC,EAAjC,EAAqC;AACnCD,IAAAA,GAAG,GAAGJ,EAAE,CAACK,CAAD,CAAR;;AACA,QAAI,CAAC1B,SAAS,CAACC,CAAC,CAACwB,GAAD,CAAF,EAASvB,CAAC,CAACuB,GAAD,CAAV,CAAd,EAAgC;AAC9B,aAAO,KAAP;AACD;AACF;;AAED,SAAO,IAAP;AACD,CArFD;AAuFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAzC,OAAO,CAAC8C,KAAR,GAAgB,SAASA,KAAT,CAAeC,GAAf,EAAoB5C,OAApB,EAA6B;AAC3C,MAAI4C,GAAG,KAAKpB,SAAR,IAAqBoB,GAAG,KAAK,IAAjC,EAAuC;AACrC,WAAOA,GAAP;AACD;;AAED,MAAIC,KAAK,CAACC,OAAN,CAAcF,GAAd,CAAJ,EAAwB;AACtB,WAAOG,UAAU,CAACH,GAAD,EAAM5C,OAAN,CAAjB;AACD;;AAED,MAAIgC,gBAAgB,CAACY,GAAD,CAApB,EAA2B;AACzB,QAAI5C,OAAO,IAAIA,OAAO,CAACgD,IAAnB,IAA2B,OAAOJ,GAAG,CAACK,MAAX,KAAsB,UAArD,EAAiE;AAC/D,aAAOL,GAAG,CAACK,MAAJ,CAAWjD,OAAX,CAAP;AACD;;AACD,WAAO4C,GAAG,CAACX,QAAJ,CAAajC,OAAb,CAAP;AACD;;AAED,MAAI4C,GAAG,CAACM,WAAR,EAAqB;AACnB,YAAQrD,OAAO,CAACsD,eAAR,CAAwBP,GAAG,CAACM,WAA5B,CAAR;AACE,WAAK,QAAL;AACE,eAAOE,WAAW,CAACR,GAAD,EAAM5C,OAAN,CAAlB;;AACF,WAAK,MAAL;AACE,eAAO,IAAI4C,GAAG,CAACM,WAAR,CAAoB,CAACN,GAArB,CAAP;;AACF,WAAK,QAAL;AACE,eAAOtD,WAAW,CAACsD,GAAD,CAAlB;;AACF;AACE;AACA;AATJ;AAWD;;AAED,MAAIA,GAAG,YAAYvD,QAAnB,EAA6B;AAC3B,WAAO,IAAIA,QAAJ,CAAauD,GAAG,CAACS,EAAjB,CAAP;AACD;;AACD,MAAIT,GAAG,YAAYzD,OAAnB,EAA4B;AAC1B,QAAIa,OAAO,IAAIA,OAAO,CAACsD,eAAvB,EAAwC;AACtC,aAAOV,GAAG,CAACK,MAAJ,EAAP;AACD;;AACD,WAAO9D,OAAO,CAACoE,UAAR,CAAmBX,GAAG,CAAC1B,QAAJ,EAAnB,CAAP;AACD;;AAED,MAAI,CAAC0B,GAAG,CAACM,WAAL,IAAoBrD,OAAO,CAAC2D,QAAR,CAAiBZ,GAAjB,CAAxB,EAA+C;AAC7C;AACA,WAAOQ,WAAW,CAACR,GAAD,EAAM5C,OAAN,CAAlB;AACD;;AAED,MAAI4C,GAAG,CAACjB,OAAR,EAAiB;AACf,WAAOiB,GAAG,CAACjB,OAAJ,EAAP;AACD;AACF,CAhDD;;AAiDA,IAAIgB,KAAK,GAAG9C,OAAO,CAAC8C,KAApB;AAEA;AACA;AACA;;AAEA9C,OAAO,CAAC4D,MAAR,GAAiB,UAASC,MAAT,EAAiB;AAChC,OAAK,IAAInB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoB,SAAS,CAAClB,MAA9B,EAAsC,EAAEF,CAAxC,EAA2C;AACzC,QAAIqB,UAAU,GAAGD,SAAS,CAACpB,CAAD,CAA1B;;AAEA,QAAIqB,UAAU,IAAI,IAAlB,EAAwB;AACtB,WAAK,IAAIC,OAAT,IAAoBD,UAApB,EAAgC;AAC9B,YAAIA,UAAU,CAACE,cAAX,CAA0BD,OAA1B,CAAJ,EAAwC;AACtCH,UAAAA,MAAM,CAACG,OAAD,CAAN,GAAkBD,UAAU,CAACC,OAAD,CAA5B;AACD;AACF;AACF;AACF;;AAED,SAAOH,MAAP;AACD,CAdD;AAgBA;AACA;AACA;;;AAEA,SAASN,WAAT,CAAqBR,GAArB,EAA0B5C,OAA1B,EAAmC;AACjC,MAAI+D,cAAc,GAAG/D,OAAO,IAAIA,OAAO,CAAC+D,cAAxC;AAAA,MACIC,QAAQ,GAAGhE,OAAO,IAAIA,OAAO,CAACgE,QADlC;AAAA,MAEIC,GAAG,GAAG,EAFV;AAAA,MAGIC,OAHJ;AAAA,MAII9B,IAJJ;AAAA,MAKI+B,GALJ;AAAA,MAMIC,CANJ;AAAA,MAOI7B,CAPJ;;AASA,MAAIwB,cAAJ,EAAoB;AAClB,SAAKK,CAAL,IAAUxB,GAAV,EAAe;AACbuB,MAAAA,GAAG,GAAGxB,KAAK,CAACC,GAAG,CAACwB,CAAD,CAAJ,EAASpE,OAAT,CAAX;;AAEA,UAAI,CAACgE,QAAD,IAAc,OAAOG,GAAP,KAAe,WAAjC,EAA+C;AAC7CD,QAAAA,OAAO,KAAKA,OAAO,GAAG,IAAf,CAAP;AACAD,QAAAA,GAAG,CAACG,CAAD,CAAH,GAASD,GAAT;AACD;AACF;AACF,GATD,MASO;AACL;AAEA/B,IAAAA,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYQ,GAAZ,CAAP;AACAL,IAAAA,CAAC,GAAGH,IAAI,CAACK,MAAT;;AAEA,WAAOF,CAAC,EAAR,EAAY;AACV6B,MAAAA,CAAC,GAAGhC,IAAI,CAACG,CAAD,CAAR;AACA4B,MAAAA,GAAG,GAAGxB,KAAK,CAACC,GAAG,CAACwB,CAAD,CAAJ,EAASpE,OAAT,CAAX;;AAEA,UAAI,CAACgE,QAAD,IAAc,OAAOG,GAAP,KAAe,WAAjC,EAA+C;AAC7C,YAAI,CAACD,OAAL,EAAc;AACZA,UAAAA,OAAO,GAAG,IAAV;AACD;;AACDD,QAAAA,GAAG,CAACG,CAAD,CAAH,GAASD,GAAT;AACD;AACF;AACF;;AAED,SAAOH,QAAQ,GACTE,OAAO,IAAID,GADF,GAETA,GAFN;AAGD;;AAED,SAASlB,UAAT,CAAoBsB,GAApB,EAAyBrE,OAAzB,EAAkC;AAChC,MAAIiE,GAAG,GAAG,EAAV;;AACA,OAAK,IAAI1B,CAAC,GAAG,CAAR,EAAW+B,CAAC,GAAGD,GAAG,CAAC5B,MAAxB,EAAgCF,CAAC,GAAG+B,CAApC,EAAuC/B,CAAC,EAAxC,EAA4C;AAC1C0B,IAAAA,GAAG,CAACM,IAAJ,CAAS5B,KAAK,CAAC0B,GAAG,CAAC9B,CAAD,CAAJ,EAASvC,OAAT,CAAd;AACD;;AACD,SAAOiE,GAAP;AACD;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEApE,OAAO,CAACG,OAAR,GAAkB,UAASwE,QAAT,EAAmBxE,OAAnB,EAA4B;AAC5C,MAAIoC,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYoC,QAAZ,CAAX;AAAA,MACIjC,CAAC,GAAGH,IAAI,CAACK,MADb;AAAA,MAEI2B,CAFJ;AAIApE,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;;AAEA,SAAOuC,CAAC,EAAR,EAAY;AACV6B,IAAAA,CAAC,GAAGhC,IAAI,CAACG,CAAD,CAAR;;AACA,QAAI,EAAE6B,CAAC,IAAIpE,OAAP,CAAJ,EAAqB;AACnBA,MAAAA,OAAO,CAACoE,CAAD,CAAP,GAAaI,QAAQ,CAACJ,CAAD,CAArB;AACD;AACF;;AAED,SAAOpE,OAAP;AACD,CAfD;AAiBA;AACA;AACA;AACA;AACA;;;AAEAH,OAAO,CAAC4E,MAAR,GAAiB,YAAW;AAC1B,SAAOC,IAAI,CAACD,MAAL,GAAcvD,QAAd,GAAyByD,MAAzB,CAAgC,CAAhC,CAAP;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA9E,OAAO,CAAC+E,KAAR,GAAgB,SAASA,KAAT,CAAeC,EAAf,EAAmBC,IAAnB,EAAyB9E,OAAzB,EAAkC;AAChDA,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACA,MAAIoC,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAY0C,IAAZ,CAAX;AACA,MAAIvC,CAAC,GAAG,CAAR;AACA,MAAIwC,GAAG,GAAG3C,IAAI,CAACK,MAAf;AACA,MAAIH,GAAJ;;AAEA,MAAItC,OAAO,CAAC+D,cAAZ,EAA4B;AAC1B,WAAOxB,CAAC,GAAGwC,GAAX,EAAgB;AACdzC,MAAAA,GAAG,GAAGF,IAAI,CAACG,CAAC,EAAF,CAAV;;AACA,UAAIvC,OAAO,CAACgF,IAAR,IAAgBhF,OAAO,CAACgF,IAAR,CAAa1C,GAAb,CAApB,EAAuC;AACrC;AACD;;AACD,UAAIuC,EAAE,CAACvC,GAAD,CAAF,IAAW,IAAf,EAAqB;AACnBuC,QAAAA,EAAE,CAACvC,GAAD,CAAF,GAAUwC,IAAI,CAACxC,GAAD,CAAd;AACD,OAFD,MAEO,IAAIzC,OAAO,CAAC2D,QAAR,CAAiBsB,IAAI,CAACxC,GAAD,CAArB,CAAJ,EAAiC;AACtCsC,QAAAA,KAAK,CAACC,EAAE,CAACvC,GAAD,CAAH,EAAUwC,IAAI,CAACxC,GAAD,CAAd,EAAqBtC,OAArB,CAAL;AACD,OAFM,MAEA,IAAIA,OAAO,CAACiF,SAAZ,EAAuB;AAC5BJ,QAAAA,EAAE,CAACvC,GAAD,CAAF,GAAUwC,IAAI,CAACxC,GAAD,CAAd;AACD;AACF;AACF,GAdD,MAcO;AACL,WAAOyC,GAAG,EAAV,EAAc;AACZzC,MAAAA,GAAG,GAAGF,IAAI,CAAC2C,GAAD,CAAV;;AACA,UAAI/E,OAAO,CAACgF,IAAR,IAAgBhF,OAAO,CAACgF,IAAR,CAAa1C,GAAb,CAApB,EAAuC;AACrC;AACD;;AACD,UAAIuC,EAAE,CAACvC,GAAD,CAAF,IAAW,IAAf,EAAqB;AACnBuC,QAAAA,EAAE,CAACvC,GAAD,CAAF,GAAUwC,IAAI,CAACxC,GAAD,CAAd;AACD,OAFD,MAEO,IAAIzC,OAAO,CAAC2D,QAAR,CAAiBsB,IAAI,CAACxC,GAAD,CAArB,CAAJ,EAAiC;AACtCsC,QAAAA,KAAK,CAACC,EAAE,CAACvC,GAAD,CAAH,EAAUwC,IAAI,CAACxC,GAAD,CAAd,EAAqBtC,OAArB,CAAL;AACD,OAFM,MAEA,IAAIA,OAAO,CAACiF,SAAZ,EAAuB;AAC5BJ,QAAAA,EAAE,CAACvC,GAAD,CAAF,GAAUwC,IAAI,CAACxC,GAAD,CAAd;AACD;AACF;AACF;AACF,CApCD;AAsCA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAzC,OAAO,CAACoC,QAAR,GAAmB,SAASA,QAAT,CAAkBW,GAAlB,EAAuB;AACxChD,EAAAA,QAAQ,KAAKA,QAAQ,GAAGR,OAAO,CAAC,YAAD,CAAvB,CAAR;AACA,MAAI6E,GAAJ;;AAEA,MAAIpE,OAAO,CAACqF,iBAAR,CAA0BtC,GAA1B,CAAJ,EAAoC;AAClC,WAAOA,GAAP;AACD;;AAED,MAAIA,GAAG,YAAYhD,QAAnB,EAA6B;AAC3B,WAAOgD,GAAG,CAACX,QAAJ,EAAP;AACD;;AAED,MAAIY,KAAK,CAACC,OAAN,CAAcF,GAAd,CAAJ,EAAwB;AACtBqB,IAAAA,GAAG,GAAG,EAAN;;AAEA,SAAK,IAAI1B,CAAC,GAAG,CAAR,EAAWwC,GAAG,GAAGnC,GAAG,CAACH,MAA1B,EAAkCF,CAAC,GAAGwC,GAAtC,EAA2C,EAAExC,CAA7C,EAAgD;AAC9C0B,MAAAA,GAAG,CAACM,IAAJ,CAAStC,QAAQ,CAACW,GAAG,CAACL,CAAD,CAAJ,CAAjB;AACD;;AAED,WAAO0B,GAAP;AACD;;AAED,MAAKrB,GAAG,CAACM,WAAJ,IAAmBrD,OAAO,CAACsD,eAAR,CAAwBP,GAAG,CAACM,WAA5B,MAA6C,QAAjE,IACC,CAACN,GAAG,CAACM,WAAL,IAAoBrD,OAAO,CAAC2D,QAAR,CAAiBZ,GAAjB,CADzB,EACiD;AAC/CqB,IAAAA,GAAG,GAAG,EAAN;;AAEA,SAAK,IAAIG,CAAT,IAAcxB,GAAd,EAAmB;AACjBqB,MAAAA,GAAG,CAACG,CAAD,CAAH,GAASnC,QAAQ,CAACW,GAAG,CAACwB,CAAD,CAAJ,CAAjB;AACD;;AAED,WAAOH,GAAP;AACD;;AAED,SAAOrB,GAAP;AACD,CAlCD;AAoCA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA/C,OAAO,CAAC2D,QAAR,GAAmB,UAAS2B,GAAT,EAAc;AAC/B,MAAIvD,MAAM,CAACC,QAAP,CAAgBsD,GAAhB,CAAJ,EAA0B;AACxB,WAAO,IAAP;AACD;;AACD,SAAOhD,MAAM,CAACV,SAAP,CAAiBP,QAAjB,CAA0BkE,IAA1B,CAA+BD,GAA/B,MAAwC,iBAA/C;AACD,CALD;AAOA;AACA;AACA;AACA;;;AAEAtF,OAAO,CAACwF,IAAR,GAAe9F,MAAf;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAM,OAAO,CAACyF,IAAR,GAAe,SAASA,IAAT,CAAcC,QAAd,EAAwB;AACrC,MAAI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC;AAClC;AACD;;AACD,SAAO,YAAW;AAChB,QAAI;AACFA,MAAAA,QAAQ,CAACC,KAAT,CAAe,IAAf,EAAqB7B,SAArB;AACD,KAFD,CAEE,OAAO8B,GAAP,EAAY;AACZ;AACA;AACAC,MAAAA,OAAO,CAACC,QAAR,CAAiB,YAAW;AAC1B,cAAMF,GAAN;AACD,OAFD;AAGD;AACF,GAVD;AAWD,CAfD;AAiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA5F,OAAO,CAACmC,gBAAR,GAA2B,UAAS4D,CAAT,EAAY;AACrChG,EAAAA,QAAQ,KAAKA,QAAQ,GAAGR,OAAO,CAAC,YAAD,CAAvB,CAAR;AACAO,EAAAA,aAAa,KAAKA,aAAa,GAAGP,OAAO,CAAC,SAAD,CAAP,CAAmByD,KAAxC,CAAb;AACAnD,EAAAA,cAAc,KAAKA,cAAc,GAAGN,OAAO,CAAC,SAAD,CAAP,CAAmBwC,MAAzC,CAAd;AAEA,SAAOgE,CAAC,YAAYhG,QAAb,IACFgG,CAAC,IAAIA,CAAC,CAACC,eADL,IAEFD,CAAC,IAAIA,CAAC,CAACE,gBAFZ;AAGD,CARD;;AASA,IAAI9D,gBAAgB,GAAGnC,OAAO,CAACmC,gBAA/B;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEAnC,OAAO,CAACkG,OAAR,GAAkB,SAASA,OAAT,CAAiBC,MAAjB,EAAyB;AACzC,MAAI,EAAEA,MAAM,IAAIA,MAAM,CAAC9C,WAAP,CAAmBnD,IAAnB,KAA4B,QAAxC,CAAJ,EAAuD;AACrD;AACD;;AACD,MAAI,EAAE,aAAaiG,MAAf,CAAJ,EAA4B;AAC1B;AACD;;AAED,MAAIC,IAAJ;;AACA,MAAI,OAAOD,MAAM,CAACD,OAAd,KAA0B,QAA9B,EAAwC;AACtCE,IAAAA,IAAI,GAAGD,MAAM,CAACD,OAAd;AACD,GAFD,MAEO;AACLE,IAAAA,IAAI,GAAGvB,IAAI,CAACwB,KAAL,CAAWzG,EAAE,CAACuG,MAAM,CAACD,OAAR,CAAF,GAAqB,IAAhC,CAAP;AACD;;AACDC,EAAAA,MAAM,CAACG,kBAAP,GAA4BF,IAA5B;AACA,SAAOD,MAAM,CAACD,OAAd;AACD,CAhBD;AAkBA;AACA;AACA;;;AAEA,SAASK,eAAT,CAAyBC,IAAzB,EAA+BC,MAA/B,EAAuC3F,KAAvC,EAA8CX,OAA9C,EAAuDuG,KAAvD,EAA8DC,WAA9D,EAA2E;AACzE,OAAKH,IAAL,GAAYA,IAAZ;AACA,OAAK1F,KAAL,GAAaA,KAAb;AACA,OAAK2F,MAAL,GAAcA,MAAd;AACA,OAAKtG,OAAL,GAAeA,OAAf;AACA,OAAKuG,KAAL,GAAaA,KAAb;;AACA,MAAI,OAAOC,WAAP,KAAuB,QAA3B,EAAqC;AACnC,SAAKC,QAAL,GAAgBD,WAAhB;AACD;;AACD,OAAKE,KAAL,GAAa,EAAb;AACD,C,CAED;;;AACAN,eAAe,CAAC3E,SAAhB,CAA0ByB,WAA1B,GAAwCf,MAAxC,C,CAEA;;AACAtC,OAAO,CAACuG,eAAR,GAA0BA,eAA1B;AAEA;AACA;AACA;;AAEAvG,OAAO,CAAC4G,QAAR,GAAmB,SAASA,QAAT,CAAkBJ,IAAlB,EAAwBC,MAAxB,EAAgCC,KAAhC,EAAuC5F,KAAvC,EAA8CX,OAA9C,EAAuDwG,WAAvD,EAAoE;AACrF;AACA;AACA;AAEA;AACA,MAAI7C,SAAS,CAAClB,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,QAAI4D,IAAI,YAAYD,eAApB,EAAqC;AACnC,aAAO,CAACC,IAAD,CAAP;AACD;;AAED,QAAIxD,KAAK,CAACC,OAAN,CAAcuD,IAAd,CAAJ,EAAyB;AACvB,aAAOA,IAAI,CAACM,GAAL,CAAS,UAASC,CAAT,EAAY;AAC1B,eAAO/G,OAAO,CAAC4G,QAAR,CAAiBG,CAAjB,EAAoB,CAApB,CAAP;AACD,OAFM,CAAP;AAGD;;AAED,QAAI/G,OAAO,CAAC2D,QAAR,CAAiB6C,IAAjB,CAAJ,EAA4B;AAC1B1F,MAAAA,KAAK,GAAG0F,IAAI,CAAC1F,KAAb;AACAX,MAAAA,OAAO,GAAGqG,IAAI,CAACrG,OAAf;AACAsG,MAAAA,MAAM,GAAGD,IAAI,CAACC,MAAd;AACAC,MAAAA,KAAK,GAAGF,IAAI,CAACE,KAAb;AACAC,MAAAA,WAAW,GAAGH,IAAI,CAACI,QAAnB;AACAJ,MAAAA,IAAI,GAAGA,IAAI,CAACA,IAAZ;AACD;AACF,GAnBD,MAmBO,IAAI,OAAOE,KAAP,KAAiB,QAAjB,IAA6B,OAAOA,KAAP,KAAiB,UAAlD,EAA8D;AACnEvG,IAAAA,OAAO,GAAGW,KAAV;AACAA,IAAAA,KAAK,GAAG4F,KAAR;AACAA,IAAAA,KAAK,GAAG/E,SAAR;AACD;;AAED,MAAI,OAAO6E,IAAP,KAAgB,QAApB,EAA8B;AAC5B,UAAM,IAAIQ,SAAJ,CAAc,gEAAgE,OAAOR,IAAvE,GAA8E,GAA5F,CAAN;AACD;;AAED,MAAI,OAAOG,WAAP,KAAuB,QAA3B,EAAqC;AACnCA,IAAAA,WAAW,GAAG3G,OAAO,CAAC4G,QAAR,CAAiBD,WAAjB,CAAd;AACD;;AAED,MAAIvC,GAAG,GAAG,EAAV;AACA,MAAI6C,KAAK,GAAGT,IAAI,CAACU,KAAL,CAAW,GAAX,CAAZ;AACA/G,EAAAA,OAAO,GAAGH,OAAO,CAAC8C,KAAR,CAAc3C,OAAd,EAAuB;AAAE+D,IAAAA,cAAc,EAAE;AAAlB,GAAvB,CAAV;;AACA,OAAK,IAAIxB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuE,KAAK,CAACrE,MAA1B,EAAkC,EAAEF,CAApC,EAAuC;AACrC0B,IAAAA,GAAG,CAACM,IAAJ,CAAS,IAAI6B,eAAJ,CAAoBU,KAAK,CAACvE,CAAD,CAAzB,EAA8B+D,MAA9B,EAAsC3F,KAAtC,EAA6CX,OAA7C,EAAsDuG,KAAtD,EAA6DC,WAA7D,CAAT;AACD;;AAED,SAAOvC,GAAP;AACD,CA/CD;AAiDA;AACA;AACA;AACA;AACA;AACA;;;AAEApE,OAAO,CAACmH,QAAR,GAAmB,UAASX,IAAT,EAAezD,GAAf,EAAoB+D,GAApB,EAAyB;AAC1C,SAAOnH,KAAK,CAACyH,GAAN,CAAUZ,IAAV,EAAgBzD,GAAhB,EAAqB,MAArB,EAA6B+D,GAA7B,CAAP;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA9G,OAAO,CAACqH,QAAR,GAAmB,UAASb,IAAT,EAAelC,GAAf,EAAoBvB,GAApB,EAAyB+D,GAAzB,EAA8B;AAC/CnH,EAAAA,KAAK,CAAC2H,GAAN,CAAUd,IAAV,EAAgBlC,GAAhB,EAAqBvB,GAArB,EAA0B,MAA1B,EAAkC+D,GAAlC;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA9G,OAAO,CAACmG,MAAR,GAAiB,EAAjB;;AACAnG,OAAO,CAACmG,MAAR,CAAeoB,IAAf,GAAsB,SAASA,IAAT,CAAcR,CAAd,EAAiB;AACrC,MAAIxE,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYwE,CAAZ,CAAX;AAAA,MACIrE,CAAC,GAAGH,IAAI,CAACK,MADb;AAAA,MAEIwB,GAAG,GAAG,EAFV;;AAIA,SAAO1B,CAAC,EAAR,EAAY;AACV0B,IAAAA,GAAG,CAACM,IAAJ,CAASqC,CAAC,CAACxE,IAAI,CAACG,CAAD,CAAL,CAAV;AACD;;AAED,SAAO0B,GAAP;AACD,CAVD;AAYA;AACA;AACA;;;AAEApE,OAAO,CAACmG,MAAR,CAAeqB,WAAf,GAA6BxH,OAAO,CAACG,OAArC;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIsH,GAAG,GAAGnF,MAAM,CAACV,SAAP,CAAiBqC,cAA3B;;AACAjE,OAAO,CAACmG,MAAR,CAAelC,cAAf,GAAgC,UAASlB,GAAT,EAAc2E,IAAd,EAAoB;AAClD,SAAOD,GAAG,CAAClC,IAAJ,CAASxC,GAAT,EAAc2E,IAAd,CAAP;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;;;AAEA1H,OAAO,CAACqF,iBAAR,GAA4B,UAASf,GAAT,EAAc;AACxC,SAAOA,GAAG,KAAK,IAAR,IAAgBA,GAAG,KAAK3C,SAA/B;AACD,CAFD;AAIA;AACA;AACA;;;AAEA3B,OAAO,CAAC2H,KAAR,GAAgB,EAAhB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA3H,OAAO,CAAC2H,KAAR,CAAcC,OAAd,GAAwB,SAASA,OAAT,CAAiBpD,GAAjB,EAAsB5D,MAAtB,EAA8BwD,GAA9B,EAAmC;AACzDA,EAAAA,GAAG,KAAKA,GAAG,GAAG,EAAX,CAAH;AAEAI,EAAAA,GAAG,CAACqD,OAAJ,CAAY,UAASC,IAAT,EAAe;AACzB,QAAI9E,KAAK,CAACC,OAAN,CAAc6E,IAAd,CAAJ,EAAyB;AACvBF,MAAAA,OAAO,CAACE,IAAD,EAAOlH,MAAP,EAAewD,GAAf,CAAP;AACD,KAFD,MAEO;AACL,UAAI,CAACxD,MAAD,IAAWA,MAAM,CAACkH,IAAD,CAArB,EAA6B;AAC3B1D,QAAAA,GAAG,CAACM,IAAJ,CAASoD,IAAT;AACD;AACF;AACF,GARD;AAUA,SAAO1D,GAAP;AACD,CAdD;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEApE,OAAO,CAAC2H,KAAR,CAAcI,MAAd,GAAuB,UAASvD,GAAT,EAAc;AACnC,MAAIwD,UAAU,GAAG,EAAjB;AACA,MAAIC,GAAG,GAAG,EAAV;AACA,MAAI7D,GAAG,GAAG,EAAV;AACA,MAAIxB,MAAM,GAAG4B,GAAG,CAAC5B,MAAjB;;AACA,OAAK,IAAIF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGE,MAApB,EAA4B,EAAEF,CAA9B,EAAiC;AAC/B,QAAI,OAAO8B,GAAG,CAAC9B,CAAD,CAAV,KAAkB,QAAlB,IAA8B,OAAO8B,GAAG,CAAC9B,CAAD,CAAV,KAAkB,QAApD,EAA8D;AAC5D,UAAIsF,UAAU,CAACxD,GAAG,CAAC9B,CAAD,CAAJ,CAAd,EAAwB;AACtB;AACD;;AACD0B,MAAAA,GAAG,CAACM,IAAJ,CAASF,GAAG,CAAC9B,CAAD,CAAZ;AACAsF,MAAAA,UAAU,CAACxD,GAAG,CAAC9B,CAAD,CAAJ,CAAV,GAAqB,IAArB;AACD,KAND,MAMO,IAAI8B,GAAG,CAAC9B,CAAD,CAAH,YAAkBlD,QAAtB,EAAgC;AACrC,UAAIyI,GAAG,CAACzD,GAAG,CAAC9B,CAAD,CAAH,CAAOrB,QAAP,EAAD,CAAP,EAA4B;AAC1B;AACD;;AACD+C,MAAAA,GAAG,CAACM,IAAJ,CAASF,GAAG,CAAC9B,CAAD,CAAZ;AACAuF,MAAAA,GAAG,CAACzD,GAAG,CAAC9B,CAAD,CAAH,CAAOrB,QAAP,EAAD,CAAH,GAAyB,IAAzB;AACD,KANM,MAMA;AACL+C,MAAAA,GAAG,CAACM,IAAJ,CAASF,GAAG,CAAC9B,CAAD,CAAZ;AACD;AACF;;AAED,SAAO0B,GAAP;AACD,CAxBD;AA0BA;AACA;AACA;AACA;AACA;AACA;;;AAEApE,OAAO,CAACiC,MAAR,GAAiB,EAAjB;;AACAjC,OAAO,CAACiC,MAAR,CAAeC,QAAf,GAA0B,UAASjB,CAAT,EAAYC,CAAZ,EAAe;AACvC,MAAI,CAACa,MAAM,CAACC,QAAP,CAAgBf,CAAhB,CAAL,EAAyB;AACvB,WAAO,KAAP;AACD;;AACD,MAAI,CAACc,MAAM,CAACC,QAAP,CAAgBd,CAAhB,CAAL,EAAyB;AACvB,WAAO,KAAP;AACD;;AACD,MAAID,CAAC,CAAC2B,MAAF,KAAa1B,CAAC,CAAC0B,MAAnB,EAA2B;AACzB,WAAO,KAAP;AACD;;AACD,OAAK,IAAIF,CAAC,GAAG,CAAR,EAAWwC,GAAG,GAAGjE,CAAC,CAAC2B,MAAxB,EAAgCF,CAAC,GAAGwC,GAApC,EAAyC,EAAExC,CAA3C,EAA8C;AAC5C,QAAIzB,CAAC,CAACyB,CAAD,CAAD,KAASxB,CAAC,CAACwB,CAAD,CAAd,EAAmB;AACjB,aAAO,KAAP;AACD;AACF;;AACD,SAAO,IAAP;AACD,CAhBD;;AAkBA1C,OAAO,CAACsD,eAAR,GAA0B,UAAS4E,EAAT,EAAa;AACrC,MAAIA,EAAE,CAAChI,IAAP,EAAa;AACX,WAAOgI,EAAE,CAAChI,IAAV;AACD;;AACD,SAAO,CAACgI,EAAE,CAAC7G,QAAH,GAAc8G,IAAd,GAAqBrH,KAArB,CAA2B,uBAA3B,KAAuD,EAAxD,EAA4D,CAA5D,CAAP;AACD,CALD;;AAOAd,OAAO,CAACoI,QAAR,GAAmB,UAASC,WAAT,EAAsB9G,MAAtB,EAA8B;AAC/C,OAAK,IAAIkB,GAAT,IAAgBlB,MAAhB,EAAwB;AACtB8G,IAAAA,WAAW,CAAC5F,GAAD,CAAX,GAAmBlB,MAAM,CAACkB,GAAD,CAAzB;AACD;AACF,CAJD;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAzC,OAAO,CAACsI,UAAR,GAAqB,UAAStD,EAAT,EAAauD,OAAb,EAAsB;AACzC,MAAIhG,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYgG,OAAZ,CAAX;AACA,MAAIrD,GAAG,GAAG3C,IAAI,CAACK,MAAf;AACA,MAAIF,CAAC,GAAG,CAAR;AACA,MAAID,GAAJ;;AAEA,SAAOC,CAAC,GAAGwC,GAAX,EAAgB;AACdzC,IAAAA,GAAG,GAAGF,IAAI,CAACG,CAAC,EAAF,CAAV;;AACA,QAAI,OAAOsC,EAAE,CAACvC,GAAD,CAAT,KAAmB,WAAvB,EAAoC;AAClC;AACA;AACAuC,MAAAA,EAAE,CAACvC,GAAD,CAAF,GAAUzC,OAAO,CAAC8C,KAAR,CAAcyF,OAAO,CAAC9F,GAAD,CAArB,EAA4B;AACpCyB,QAAAA,cAAc,EAAE,CADoB;AAEpCT,QAAAA,eAAe,EAAE;AAFmB,OAA5B,CAAV;AAID,KAPD,MAOO;AACL,UAAIzD,OAAO,CAAC2D,QAAR,CAAiB4E,OAAO,CAAC9F,GAAD,CAAxB,CAAJ,EAAoC;AAClC,YAAIM,GAAG,GAAGwF,OAAO,CAAC9F,GAAD,CAAjB;;AACA,YAAIN,gBAAgB,CAACoG,OAAO,CAAC9F,GAAD,CAAR,CAAhB,IAAkC,CAAC8F,OAAO,CAAC9F,GAAD,CAAP,CAAawD,gBAApD,EAAsE;AACpElD,UAAAA,GAAG,GAAGA,GAAG,CAACX,QAAJ,CAAa;AAAEoG,YAAAA,SAAS,EAAE,KAAb;AAAoBC,YAAAA,QAAQ,EAAE;AAA9B,WAAb,CAAN;AACD;;AACD,YAAIF,OAAO,CAAC9F,GAAD,CAAP,CAAawD,gBAAjB,EAAmC;AACjClD,UAAAA,GAAG,GAAG,IAAIhB,MAAJ,CAAWgB,GAAX,CAAN;AACD;;AACD/C,QAAAA,OAAO,CAACsI,UAAR,CAAmBtD,EAAE,CAACvC,GAAD,CAArB,EAA4BM,GAA5B;AACD,OATD,MASO;AACL;AACA;AACAiC,QAAAA,EAAE,CAACvC,GAAD,CAAF,GAAUzC,OAAO,CAAC8C,KAAR,CAAcyF,OAAO,CAAC9F,GAAD,CAArB,EAA4B;AACpCyB,UAAAA,cAAc,EAAE,CADoB;AAEpCT,UAAAA,eAAe,EAAE;AAFmB,SAA5B,CAAV;AAID;AACF;AACF;AACF,CAnCD;AAqCA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAzD,OAAO,CAAC0I,IAAR,GAAe,UAASlE,GAAT,EAAc0D,EAAd,EAAkB;AAC/B,OAAK,IAAIxF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8B,GAAG,CAAC5B,MAAxB,EAAgC,EAAEF,CAAlC,EAAqC;AACnCwF,IAAAA,EAAE,CAAC1D,GAAG,CAAC9B,CAAD,CAAJ,CAAF;AACD;AACF,CAJD;AAMA;AACA;AACA;;;AAEA1C,OAAO,CAAC2I,IAAR,GAAe,YAAW,CAAE,CAA5B","sourcesContent":["/*!\n * Module dependencies.\n */\n\nvar Decimal = require('./types/decimal128');\nvar ObjectId = require('./types/objectid');\nvar cloneRegExp = require('regexp-clone');\nvar sliced = require('sliced');\nvar mpath = require('mpath');\nvar ms = require('ms');\nvar MongooseBuffer;\nvar MongooseArray;\nvar Document;\n\n/*!\n * Produces a collection name from model `name`.\n *\n * @param {String} name a model name\n * @return {String} a collection name\n * @api private\n */\n\nexports.toCollectionName = function(name, options) {\n  options = options || {};\n  if (name === 'system.profile') {\n    return name;\n  }\n  if (name === 'system.indexes') {\n    return name;\n  }\n  if (options.pluralization === false) {\n    return name;\n  }\n  return pluralize(name.toLowerCase());\n};\n\n/**\n * Pluralization rules.\n *\n * These rules are applied while processing the argument to `toCollectionName`.\n *\n * @deprecated remove in 4.x gh-1350\n */\n\nexports.pluralization = [\n  [/(m)an$/gi, '$1en'],\n  [/(pe)rson$/gi, '$1ople'],\n  [/(child)$/gi, '$1ren'],\n  [/^(ox)$/gi, '$1en'],\n  [/(ax|test)is$/gi, '$1es'],\n  [/(octop|vir)us$/gi, '$1i'],\n  [/(alias|status)$/gi, '$1es'],\n  [/(bu)s$/gi, '$1ses'],\n  [/(buffal|tomat|potat)o$/gi, '$1oes'],\n  [/([ti])um$/gi, '$1a'],\n  [/sis$/gi, 'ses'],\n  [/(?:([^f])fe|([lr])f)$/gi, '$1$2ves'],\n  [/(hive)$/gi, '$1s'],\n  [/([^aeiouy]|qu)y$/gi, '$1ies'],\n  [/(x|ch|ss|sh)$/gi, '$1es'],\n  [/(matr|vert|ind)ix|ex$/gi, '$1ices'],\n  [/([m|l])ouse$/gi, '$1ice'],\n  [/(kn|w|l)ife$/gi, '$1ives'],\n  [/(quiz)$/gi, '$1zes'],\n  [/s$/gi, 's'],\n  [/([^a-z])$/, '$1'],\n  [/$/gi, 's']\n];\nvar rules = exports.pluralization;\n\n/**\n * Uncountable words.\n *\n * These words are applied while processing the argument to `toCollectionName`.\n * @api public\n */\n\nexports.uncountables = [\n  'advice',\n  'energy',\n  'excretion',\n  'digestion',\n  'cooperation',\n  'health',\n  'justice',\n  'labour',\n  'machinery',\n  'equipment',\n  'information',\n  'pollution',\n  'sewage',\n  'paper',\n  'money',\n  'species',\n  'series',\n  'rain',\n  'rice',\n  'fish',\n  'sheep',\n  'moose',\n  'deer',\n  'news',\n  'expertise',\n  'status',\n  'media'\n];\nvar uncountables = exports.uncountables;\n\n/*!\n * Pluralize function.\n *\n * @author TJ Holowaychuk (extracted from _ext.js_)\n * @param {String} string to pluralize\n * @api private\n */\n\nfunction pluralize(str) {\n  var found;\n  if (!~uncountables.indexOf(str.toLowerCase())) {\n    found = rules.filter(function(rule) {\n      return str.match(rule[0]);\n    });\n    if (found[0]) {\n      return str.replace(found[0][0], found[0][1]);\n    }\n  }\n  return str;\n}\n\n/*!\n * Determines if `a` and `b` are deep equal.\n *\n * Modified from node/lib/assert.js\n *\n * @param {any} a a value to compare to `b`\n * @param {any} b a value to compare to `a`\n * @return {Boolean}\n * @api private\n */\n\nexports.deepEqual = function deepEqual(a, b) {\n  if (a === b) {\n    return true;\n  }\n\n  if (a instanceof Date && b instanceof Date) {\n    return a.getTime() === b.getTime();\n  }\n\n  if ((a instanceof ObjectId && b instanceof ObjectId) ||\n      (a instanceof Decimal && b instanceof Decimal)) {\n    return a.toString() === b.toString();\n  }\n\n  if (a instanceof RegExp && b instanceof RegExp) {\n    return a.source === b.source &&\n        a.ignoreCase === b.ignoreCase &&\n        a.multiline === b.multiline &&\n        a.global === b.global;\n  }\n\n  if (typeof a !== 'object' && typeof b !== 'object') {\n    return a == b;\n  }\n\n  if (a === null || b === null || a === undefined || b === undefined) {\n    return false;\n  }\n\n  if (a.prototype !== b.prototype) {\n    return false;\n  }\n\n  // Handle MongooseNumbers\n  if (a instanceof Number && b instanceof Number) {\n    return a.valueOf() === b.valueOf();\n  }\n\n  if (Buffer.isBuffer(a)) {\n    return exports.buffer.areEqual(a, b);\n  }\n\n  if (isMongooseObject(a)) {\n    a = a.toObject();\n  }\n  if (isMongooseObject(b)) {\n    b = b.toObject();\n  }\n\n  try {\n    var ka = Object.keys(a),\n        kb = Object.keys(b),\n        key, i;\n  } catch (e) {\n    // happens when one is a string literal and the other isn't\n    return false;\n  }\n\n  // having the same number of owned properties (keys incorporates\n  // hasOwnProperty)\n  if (ka.length !== kb.length) {\n    return false;\n  }\n\n  // the same set of keys (although not necessarily the same order),\n  ka.sort();\n  kb.sort();\n\n  // ~~~cheap key test\n  for (i = ka.length - 1; i >= 0; i--) {\n    if (ka[i] !== kb[i]) {\n      return false;\n    }\n  }\n\n  // equivalent values for every corresponding key, and\n  // ~~~possibly expensive deep test\n  for (i = ka.length - 1; i >= 0; i--) {\n    key = ka[i];\n    if (!deepEqual(a[key], b[key])) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\n/*!\n * Object clone with Mongoose natives support.\n *\n * If options.minimize is true, creates a minimal data object. Empty objects and undefined values will not be cloned. This makes the data payload sent to MongoDB as small as possible.\n *\n * Functions are never cloned.\n *\n * @param {Object} obj the object to clone\n * @param {Object} options\n * @return {Object} the cloned object\n * @api private\n */\n\nexports.clone = function clone(obj, options) {\n  if (obj === undefined || obj === null) {\n    return obj;\n  }\n\n  if (Array.isArray(obj)) {\n    return cloneArray(obj, options);\n  }\n\n  if (isMongooseObject(obj)) {\n    if (options && options.json && typeof obj.toJSON === 'function') {\n      return obj.toJSON(options);\n    }\n    return obj.toObject(options);\n  }\n\n  if (obj.constructor) {\n    switch (exports.getFunctionName(obj.constructor)) {\n      case 'Object':\n        return cloneObject(obj, options);\n      case 'Date':\n        return new obj.constructor(+obj);\n      case 'RegExp':\n        return cloneRegExp(obj);\n      default:\n        // ignore\n        break;\n    }\n  }\n\n  if (obj instanceof ObjectId) {\n    return new ObjectId(obj.id);\n  }\n  if (obj instanceof Decimal) {\n    if (options && options.flattenDecimals) {\n      return obj.toJSON();\n    }\n    return Decimal.fromString(obj.toString());\n  }\n\n  if (!obj.constructor && exports.isObject(obj)) {\n    // object created with Object.create(null)\n    return cloneObject(obj, options);\n  }\n\n  if (obj.valueOf) {\n    return obj.valueOf();\n  }\n};\nvar clone = exports.clone;\n\n/*!\n * TODO: replace with Object.assign() in 5.0\n */\n\nexports.assign = function(target) {\n  for (var i = 1; i < arguments.length; ++i) {\n    var nextSource = arguments[i];\n\n    if (nextSource != null) {\n      for (var nextKey in nextSource) {\n        if (nextSource.hasOwnProperty(nextKey)) {\n          target[nextKey] = nextSource[nextKey];\n        }\n      }\n    }\n  }\n\n  return target;\n};\n\n/*!\n * ignore\n */\n\nfunction cloneObject(obj, options) {\n  var retainKeyOrder = options && options.retainKeyOrder,\n      minimize = options && options.minimize,\n      ret = {},\n      hasKeys,\n      keys,\n      val,\n      k,\n      i;\n\n  if (retainKeyOrder) {\n    for (k in obj) {\n      val = clone(obj[k], options);\n\n      if (!minimize || (typeof val !== 'undefined')) {\n        hasKeys || (hasKeys = true);\n        ret[k] = val;\n      }\n    }\n  } else {\n    // faster\n\n    keys = Object.keys(obj);\n    i = keys.length;\n\n    while (i--) {\n      k = keys[i];\n      val = clone(obj[k], options);\n\n      if (!minimize || (typeof val !== 'undefined')) {\n        if (!hasKeys) {\n          hasKeys = true;\n        }\n        ret[k] = val;\n      }\n    }\n  }\n\n  return minimize\n      ? hasKeys && ret\n      : ret;\n}\n\nfunction cloneArray(arr, options) {\n  var ret = [];\n  for (var i = 0, l = arr.length; i < l; i++) {\n    ret.push(clone(arr[i], options));\n  }\n  return ret;\n}\n\n/*!\n * Shallow copies defaults into options.\n *\n * @param {Object} defaults\n * @param {Object} options\n * @return {Object} the merged object\n * @api private\n */\n\nexports.options = function(defaults, options) {\n  var keys = Object.keys(defaults),\n      i = keys.length,\n      k;\n\n  options = options || {};\n\n  while (i--) {\n    k = keys[i];\n    if (!(k in options)) {\n      options[k] = defaults[k];\n    }\n  }\n\n  return options;\n};\n\n/*!\n * Generates a random string\n *\n * @api private\n */\n\nexports.random = function() {\n  return Math.random().toString().substr(3);\n};\n\n/*!\n * Merges `from` into `to` without overwriting existing properties.\n *\n * @param {Object} to\n * @param {Object} from\n * @api private\n */\n\nexports.merge = function merge(to, from, options) {\n  options = options || {};\n  var keys = Object.keys(from);\n  var i = 0;\n  var len = keys.length;\n  var key;\n\n  if (options.retainKeyOrder) {\n    while (i < len) {\n      key = keys[i++];\n      if (options.omit && options.omit[key]) {\n        continue;\n      }\n      if (to[key] == null) {\n        to[key] = from[key];\n      } else if (exports.isObject(from[key])) {\n        merge(to[key], from[key], options);\n      } else if (options.overwrite) {\n        to[key] = from[key];\n      }\n    }\n  } else {\n    while (len--) {\n      key = keys[len];\n      if (options.omit && options.omit[key]) {\n        continue;\n      }\n      if (to[key] == null) {\n        to[key] = from[key];\n      } else if (exports.isObject(from[key])) {\n        merge(to[key], from[key], options);\n      } else if (options.overwrite) {\n        to[key] = from[key];\n      }\n    }\n  }\n};\n\n/*!\n * Applies toObject recursively.\n *\n * @param {Document|Array|Object} obj\n * @return {Object}\n * @api private\n */\n\nexports.toObject = function toObject(obj) {\n  Document || (Document = require('./document'));\n  var ret;\n\n  if (exports.isNullOrUndefined(obj)) {\n    return obj;\n  }\n\n  if (obj instanceof Document) {\n    return obj.toObject();\n  }\n\n  if (Array.isArray(obj)) {\n    ret = [];\n\n    for (var i = 0, len = obj.length; i < len; ++i) {\n      ret.push(toObject(obj[i]));\n    }\n\n    return ret;\n  }\n\n  if ((obj.constructor && exports.getFunctionName(obj.constructor) === 'Object') ||\n      (!obj.constructor && exports.isObject(obj))) {\n    ret = {};\n\n    for (var k in obj) {\n      ret[k] = toObject(obj[k]);\n    }\n\n    return ret;\n  }\n\n  return obj;\n};\n\n/*!\n * Determines if `arg` is an object.\n *\n * @param {Object|Array|String|Function|RegExp|any} arg\n * @api private\n * @return {Boolean}\n */\n\nexports.isObject = function(arg) {\n  if (Buffer.isBuffer(arg)) {\n    return true;\n  }\n  return Object.prototype.toString.call(arg) === '[object Object]';\n};\n\n/*!\n * A faster Array.prototype.slice.call(arguments) alternative\n * @api private\n */\n\nexports.args = sliced;\n\n/*!\n * process.nextTick helper.\n *\n * Wraps `callback` in a try/catch + nextTick.\n *\n * node-mongodb-native has a habit of state corruption when an error is immediately thrown from within a collection callback.\n *\n * @param {Function} callback\n * @api private\n */\n\nexports.tick = function tick(callback) {\n  if (typeof callback !== 'function') {\n    return;\n  }\n  return function() {\n    try {\n      callback.apply(this, arguments);\n    } catch (err) {\n      // only nextTick on err to get out of\n      // the event loop and avoid state corruption.\n      process.nextTick(function() {\n        throw err;\n      });\n    }\n  };\n};\n\n/*!\n * Returns if `v` is a mongoose object that has a `toObject()` method we can use.\n *\n * This is for compatibility with libs like Date.js which do foolish things to Natives.\n *\n * @param {any} v\n * @api private\n */\n\nexports.isMongooseObject = function(v) {\n  Document || (Document = require('./document'));\n  MongooseArray || (MongooseArray = require('./types').Array);\n  MongooseBuffer || (MongooseBuffer = require('./types').Buffer);\n\n  return v instanceof Document ||\n      (v && v.isMongooseArray) ||\n      (v && v.isMongooseBuffer);\n};\nvar isMongooseObject = exports.isMongooseObject;\n\n/*!\n * Converts `expires` options of index objects to `expiresAfterSeconds` options for MongoDB.\n *\n * @param {Object} object\n * @api private\n */\n\nexports.expires = function expires(object) {\n  if (!(object && object.constructor.name === 'Object')) {\n    return;\n  }\n  if (!('expires' in object)) {\n    return;\n  }\n\n  var when;\n  if (typeof object.expires !== 'string') {\n    when = object.expires;\n  } else {\n    when = Math.round(ms(object.expires) / 1000);\n  }\n  object.expireAfterSeconds = when;\n  delete object.expires;\n};\n\n/*!\n * Populate options constructor\n */\n\nfunction PopulateOptions(path, select, match, options, model, subPopulate) {\n  this.path = path;\n  this.match = match;\n  this.select = select;\n  this.options = options;\n  this.model = model;\n  if (typeof subPopulate === 'object') {\n    this.populate = subPopulate;\n  }\n  this._docs = {};\n}\n\n// make it compatible with utils.clone\nPopulateOptions.prototype.constructor = Object;\n\n// expose\nexports.PopulateOptions = PopulateOptions;\n\n/*!\n * populate helper\n */\n\nexports.populate = function populate(path, select, model, match, options, subPopulate) {\n  // The order of select/conditions args is opposite Model.find but\n  // necessary to keep backward compatibility (select could be\n  // an array, string, or object literal).\n\n  // might have passed an object specifying all arguments\n  if (arguments.length === 1) {\n    if (path instanceof PopulateOptions) {\n      return [path];\n    }\n\n    if (Array.isArray(path)) {\n      return path.map(function(o) {\n        return exports.populate(o)[0];\n      });\n    }\n\n    if (exports.isObject(path)) {\n      match = path.match;\n      options = path.options;\n      select = path.select;\n      model = path.model;\n      subPopulate = path.populate;\n      path = path.path;\n    }\n  } else if (typeof model !== 'string' && typeof model !== 'function') {\n    options = match;\n    match = model;\n    model = undefined;\n  }\n\n  if (typeof path !== 'string') {\n    throw new TypeError('utils.populate: invalid path. Expected string. Got typeof `' + typeof path + '`');\n  }\n\n  if (typeof subPopulate === 'object') {\n    subPopulate = exports.populate(subPopulate);\n  }\n\n  var ret = [];\n  var paths = path.split(' ');\n  options = exports.clone(options, { retainKeyOrder: true });\n  for (var i = 0; i < paths.length; ++i) {\n    ret.push(new PopulateOptions(paths[i], select, match, options, model, subPopulate));\n  }\n\n  return ret;\n};\n\n/*!\n * Return the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Object} obj\n */\n\nexports.getValue = function(path, obj, map) {\n  return mpath.get(path, obj, '_doc', map);\n};\n\n/*!\n * Sets the value of `obj` at the given `path`.\n *\n * @param {String} path\n * @param {Anything} val\n * @param {Object} obj\n */\n\nexports.setValue = function(path, val, obj, map) {\n  mpath.set(path, val, obj, '_doc', map);\n};\n\n/*!\n * Returns an array of values from object `o`.\n *\n * @param {Object} o\n * @return {Array}\n * @private\n */\n\nexports.object = {};\nexports.object.vals = function vals(o) {\n  var keys = Object.keys(o),\n      i = keys.length,\n      ret = [];\n\n  while (i--) {\n    ret.push(o[keys[i]]);\n  }\n\n  return ret;\n};\n\n/*!\n * @see exports.options\n */\n\nexports.object.shallowCopy = exports.options;\n\n/*!\n * Safer helper for hasOwnProperty checks\n *\n * @param {Object} obj\n * @param {String} prop\n */\n\nvar hop = Object.prototype.hasOwnProperty;\nexports.object.hasOwnProperty = function(obj, prop) {\n  return hop.call(obj, prop);\n};\n\n/*!\n * Determine if `val` is null or undefined\n *\n * @return {Boolean}\n */\n\nexports.isNullOrUndefined = function(val) {\n  return val === null || val === undefined;\n};\n\n/*!\n * ignore\n */\n\nexports.array = {};\n\n/*!\n * Flattens an array.\n *\n * [ 1, [ 2, 3, [4] ]] -> [1,2,3,4]\n *\n * @param {Array} arr\n * @param {Function} [filter] If passed, will be invoked with each item in the array. If `filter` returns a falsey value, the item will not be included in the results.\n * @return {Array}\n * @private\n */\n\nexports.array.flatten = function flatten(arr, filter, ret) {\n  ret || (ret = []);\n\n  arr.forEach(function(item) {\n    if (Array.isArray(item)) {\n      flatten(item, filter, ret);\n    } else {\n      if (!filter || filter(item)) {\n        ret.push(item);\n      }\n    }\n  });\n\n  return ret;\n};\n\n/*!\n * Removes duplicate values from an array\n *\n * [1, 2, 3, 3, 5] => [1, 2, 3, 5]\n * [ ObjectId(\"550988ba0c19d57f697dc45e\"), ObjectId(\"550988ba0c19d57f697dc45e\") ]\n *    => [ObjectId(\"550988ba0c19d57f697dc45e\")]\n *\n * @param {Array} arr\n * @return {Array}\n * @private\n */\n\nexports.array.unique = function(arr) {\n  var primitives = {};\n  var ids = {};\n  var ret = [];\n  var length = arr.length;\n  for (var i = 0; i < length; ++i) {\n    if (typeof arr[i] === 'number' || typeof arr[i] === 'string') {\n      if (primitives[arr[i]]) {\n        continue;\n      }\n      ret.push(arr[i]);\n      primitives[arr[i]] = true;\n    } else if (arr[i] instanceof ObjectId) {\n      if (ids[arr[i].toString()]) {\n        continue;\n      }\n      ret.push(arr[i]);\n      ids[arr[i].toString()] = true;\n    } else {\n      ret.push(arr[i]);\n    }\n  }\n\n  return ret;\n};\n\n/*!\n * Determines if two buffers are equal.\n *\n * @param {Buffer} a\n * @param {Object} b\n */\n\nexports.buffer = {};\nexports.buffer.areEqual = function(a, b) {\n  if (!Buffer.isBuffer(a)) {\n    return false;\n  }\n  if (!Buffer.isBuffer(b)) {\n    return false;\n  }\n  if (a.length !== b.length) {\n    return false;\n  }\n  for (var i = 0, len = a.length; i < len; ++i) {\n    if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n  return true;\n};\n\nexports.getFunctionName = function(fn) {\n  if (fn.name) {\n    return fn.name;\n  }\n  return (fn.toString().trim().match(/^function\\s*([^\\s(]+)/) || [])[1];\n};\n\nexports.decorate = function(destination, source) {\n  for (var key in source) {\n    destination[key] = source[key];\n  }\n};\n\n/**\n * merges to with a copy of from\n *\n * @param {Object} to\n * @param {Object} fromObj\n * @api private\n */\n\nexports.mergeClone = function(to, fromObj) {\n  var keys = Object.keys(fromObj);\n  var len = keys.length;\n  var i = 0;\n  var key;\n\n  while (i < len) {\n    key = keys[i++];\n    if (typeof to[key] === 'undefined') {\n      // make sure to retain key order here because of a bug handling the $each\n      // operator in mongodb 2.4.4\n      to[key] = exports.clone(fromObj[key], {\n        retainKeyOrder: 1,\n        flattenDecimals: false\n      });\n    } else {\n      if (exports.isObject(fromObj[key])) {\n        var obj = fromObj[key];\n        if (isMongooseObject(fromObj[key]) && !fromObj[key].isMongooseBuffer) {\n          obj = obj.toObject({ transform: false, virtuals: false });\n        }\n        if (fromObj[key].isMongooseBuffer) {\n          obj = new Buffer(obj);\n        }\n        exports.mergeClone(to[key], obj);\n      } else {\n        // make sure to retain key order here because of a bug handling the\n        // $each operator in mongodb 2.4.4\n        to[key] = exports.clone(fromObj[key], {\n          retainKeyOrder: 1,\n          flattenDecimals: false\n        });\n      }\n    }\n  }\n};\n\n/**\n * Executes a function on each element of an array (like _.each)\n *\n * @param {Array} arr\n * @param {Function} fn\n * @api private\n */\n\nexports.each = function(arr, fn) {\n  for (var i = 0; i < arr.length; ++i) {\n    fn(arr[i]);\n  }\n};\n\n/*!\n * ignore\n */\n\nexports.noop = function() {};\n"]},"metadata":{},"sourceType":"script"}