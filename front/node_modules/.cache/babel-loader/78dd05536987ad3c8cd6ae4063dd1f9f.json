{"ast":null,"code":"'use strict';\n\nfunction Kareem() {\n  this._pres = {};\n  this._posts = {};\n}\n\nKareem.prototype.execPre = function (name, context, args, callback) {\n  if (arguments.length === 3) {\n    callback = args;\n    args = [];\n  }\n\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n  var $args = args;\n\n  if (!numPres) {\n    return process.nextTick(function () {\n      callback(null);\n    });\n  }\n\n  var next = function () {\n    if (currentPre >= numPres) {\n      return;\n    }\n\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      pre.fn.call(context, function (error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          return callback(error);\n        }\n\n        ++currentPre;\n        next.apply(context, arguments);\n      }, function (error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          return callback(error);\n        }\n\n        if (--numAsyncPres === 0) {\n          return callback(null);\n        }\n      });\n    } else if (pre.fn.length > 0) {\n      var args = [function (error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n\n          done = true;\n          return callback(error);\n        }\n\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return callback(null);\n          }\n        }\n\n        next.apply(context, arguments);\n      }];\n\n      var _args = arguments.length >= 2 ? arguments : [null].concat($args);\n\n      for (var i = 1; i < _args.length; ++i) {\n        args.push(_args[i]);\n      }\n\n      pre.fn.apply(context, args);\n    } else {\n      pre.fn.call(context);\n\n      if (++currentPre >= numPres) {\n        if (asyncPresLeft > 0) {\n          // Leave parallel hooks to run\n          return;\n        } else {\n          return process.nextTick(function () {\n            callback(null);\n          });\n        }\n      }\n\n      next();\n    }\n  };\n\n  next.apply(null, [null].concat(args));\n};\n\nKareem.prototype.execPreSync = function (name, context) {\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n\n  for (var i = 0; i < numPres; ++i) {\n    pres[i].fn.call(context);\n  }\n};\n\nKareem.prototype.execPost = function (name, context, args, options, callback) {\n  if (arguments.length < 5) {\n    callback = options;\n    options = null;\n  }\n\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n  var currentPost = 0;\n  var firstError = null;\n\n  if (options && options.error) {\n    firstError = options.error;\n  }\n\n  if (!numPosts) {\n    return process.nextTick(function () {\n      callback.apply(null, [firstError].concat(args));\n    });\n  }\n\n  var next = function () {\n    var post = posts[currentPost];\n    var numArgs = 0;\n    var argLength = args.length;\n    var newArgs = [];\n\n    for (var i = 0; i < argLength; ++i) {\n      numArgs += args[i] && args[i]._kareemIgnore ? 0 : 1;\n\n      if (!args[i] || !args[i]._kareemIgnore) {\n        newArgs.push(args[i]);\n      }\n    }\n\n    if (firstError) {\n      if (post.length === numArgs + 2) {\n        post.apply(context, [firstError].concat(newArgs).concat(function (error) {\n          if (error) {\n            firstError = error;\n          }\n\n          if (++currentPost >= numPosts) {\n            return callback.call(null, firstError);\n          }\n\n          next();\n        }));\n      } else {\n        if (++currentPost >= numPosts) {\n          return callback.call(null, firstError);\n        }\n\n        next();\n      }\n    } else {\n      if (post.length === numArgs + 2) {\n        // Skip error handlers if no error\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        return next();\n      }\n\n      if (post.length === numArgs + 1) {\n        post.apply(context, newArgs.concat(function (error) {\n          if (error) {\n            firstError = error;\n            return next();\n          }\n\n          if (++currentPost >= numPosts) {\n            return callback.apply(null, [null].concat(args));\n          }\n\n          next();\n        }));\n      } else {\n        post.apply(context, newArgs);\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      }\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPostSync = function (name, context) {\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n\n  for (var i = 0; i < numPosts; ++i) {\n    posts[i].call(context);\n  }\n};\n\nfunction _handleWrapError(instance, error, name, context, args, options, callback) {\n  if (options.useErrorHandlers) {\n    var _options = {\n      error: error\n    };\n    return instance.execPost(name, context, args, _options, function (error) {\n      return typeof callback === 'function' && callback(error);\n    });\n  } else {\n    return typeof callback === 'function' ? callback(error) : undefined;\n  }\n}\n\nKareem.prototype.wrap = function (name, fn, context, args, options) {\n  var lastArg = args.length > 0 ? args[args.length - 1] : null;\n  var argsWithoutCb = typeof lastArg === 'function' ? args.slice(0, args.length - 1) : args;\n\n  var _this = this;\n\n  var useLegacyPost;\n\n  if (typeof options === 'object') {\n    useLegacyPost = options && options.useLegacyPost;\n  } else {\n    useLegacyPost = options;\n  }\n\n  options = options || {};\n  this.execPre(name, context, args, function (error) {\n    if (error) {\n      var numCallbackParams = options.numCallbackParams || 0;\n      var nulls = [];\n\n      for (var i = 0; i < numCallbackParams; ++i) {\n        nulls.push(null);\n      }\n\n      return _handleWrapError(_this, error, name, context, nulls, options, lastArg);\n    }\n\n    var end = typeof lastArg === 'function' ? args.length - 1 : args.length;\n    fn.apply(context, args.slice(0, end).concat(function () {\n      var args = arguments;\n      var argsWithoutError = Array.prototype.slice.call(arguments, 1);\n\n      if (options.nullResultByDefault && argsWithoutError.length === 0) {\n        argsWithoutError.push(null);\n      }\n\n      if (arguments[0]) {\n        // Assume error\n        return _handleWrapError(_this, arguments[0], name, context, argsWithoutError, options, lastArg);\n      } else {\n        if (useLegacyPost && typeof lastArg === 'function') {\n          lastArg.apply(context, arguments);\n        }\n\n        _this.execPost(name, context, argsWithoutError, function () {\n          if (arguments[0]) {\n            return typeof lastArg === 'function' ? lastArg(arguments[0]) : undefined;\n          }\n\n          return typeof lastArg === 'function' && !useLegacyPost ? lastArg.apply(context, arguments) : undefined;\n        });\n      }\n    }));\n  });\n};\n\nKareem.prototype.createWrapper = function (name, fn, context, options) {\n  var _this = this;\n\n  return function () {\n    var args = Array.prototype.slice.call(arguments);\n\n    _this.wrap(name, fn, context, args, options);\n  };\n};\n\nKareem.prototype.pre = function (name, isAsync, fn, error) {\n  if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  this._pres[name] = this._pres[name] || [];\n  var pres = this._pres[name];\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  pres.push({\n    fn: fn,\n    isAsync: isAsync\n  });\n  return this;\n};\n\nKareem.prototype.post = function (name, fn) {\n  (this._posts[name] = this._posts[name] || []).push(fn);\n  return this;\n};\n\nKareem.prototype.clone = function () {\n  var n = new Kareem();\n\n  for (var key in this._pres) {\n    if (!this._pres.hasOwnProperty(key)) {\n      continue;\n    }\n\n    n._pres[key] = this._pres[key].slice();\n    n._pres[key].numAsync = this._pres[key].numAsync;\n  }\n\n  for (var key in this._posts) {\n    if (!this._posts.hasOwnProperty(key)) {\n      continue;\n    }\n\n    n._posts[key] = this._posts[key].slice();\n  }\n\n  return n;\n};\n\nKareem.prototype.merge = function (other) {\n  var ret = this.clone();\n\n  for (var key in other._pres) {\n    if (!other._pres.hasOwnProperty(key)) {\n      continue;\n    }\n\n    ret._pres[key] = (ret._pres[key] || []).concat(other._pres[key].slice());\n    ret._pres[key].numAsync += other._pres[key].numAsync;\n  }\n\n  for (var key in other._posts) {\n    if (!other._posts.hasOwnProperty(key)) {\n      continue;\n    }\n\n    ret._posts[key] = (ret._posts[key] || []).concat(other._posts[key].slice());\n  }\n\n  return ret;\n};\n\nmodule.exports = Kareem;","map":{"version":3,"sources":["/home/pumaguma/Desktop/project-draft/front/node_modules/kareem/index.js"],"names":["Kareem","_pres","_posts","prototype","execPre","name","context","args","callback","arguments","length","pres","numPres","numAsyncPres","numAsync","currentPre","asyncPresLeft","done","$args","process","nextTick","next","pre","isAsync","fn","call","error","apply","_args","concat","i","push","execPreSync","execPost","options","posts","numPosts","currentPost","firstError","post","numArgs","argLength","newArgs","_kareemIgnore","execPostSync","_handleWrapError","instance","useErrorHandlers","_options","undefined","wrap","lastArg","argsWithoutCb","slice","_this","useLegacyPost","numCallbackParams","nulls","end","argsWithoutError","Array","nullResultByDefault","createWrapper","clone","n","key","hasOwnProperty","merge","other","ret","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nfunction Kareem() {\n  this._pres = {};\n  this._posts = {};\n}\n\nKareem.prototype.execPre = function(name, context, args, callback) {\n  if (arguments.length === 3) {\n    callback = args;\n    args = [];\n  }\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n  var numAsyncPres = pres.numAsync || 0;\n  var currentPre = 0;\n  var asyncPresLeft = numAsyncPres;\n  var done = false;\n  var $args = args;\n\n  if (!numPres) {\n    return process.nextTick(function() {\n      callback(null);\n    });\n  }\n\n  var next = function() {\n    if (currentPre >= numPres) {\n      return;\n    }\n    var pre = pres[currentPre];\n\n    if (pre.isAsync) {\n      pre.fn.call(\n        context,\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          ++currentPre;\n          next.apply(context, arguments);\n        },\n        function(error) {\n          if (error) {\n            if (done) {\n              return;\n            }\n            done = true;\n            return callback(error);\n          }\n\n          if (--numAsyncPres === 0) {\n            return callback(null);\n          }\n        });\n    } else if (pre.fn.length > 0) {\n      var args = [function(error) {\n        if (error) {\n          if (done) {\n            return;\n          }\n          done = true;\n          return callback(error);\n        }\n\n        if (++currentPre >= numPres) {\n          if (asyncPresLeft > 0) {\n            // Leave parallel hooks to run\n            return;\n          } else {\n            return callback(null);\n          }\n        }\n\n        next.apply(context, arguments);\n      }];\n      var _args = arguments.length >= 2 ? arguments : [null].concat($args);\n      for (var i = 1; i < _args.length; ++i) {\n        args.push(_args[i]);\n      }\n      pre.fn.apply(context, args);\n    } else {\n      pre.fn.call(context);\n      if (++currentPre >= numPres) {\n        if (asyncPresLeft > 0) {\n          // Leave parallel hooks to run\n          return;\n        } else {\n          return process.nextTick(function() {\n            callback(null);\n          });\n        }\n      }\n      next();\n    }\n  };\n\n  next.apply(null, [null].concat(args));\n};\n\nKareem.prototype.execPreSync = function(name, context) {\n  var pres = this._pres[name] || [];\n  var numPres = pres.length;\n\n  for (var i = 0; i < numPres; ++i) {\n    pres[i].fn.call(context);\n  }\n};\n\nKareem.prototype.execPost = function(name, context, args, options, callback) {\n  if (arguments.length < 5) {\n    callback = options;\n    options = null;\n  }\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n  var currentPost = 0;\n\n  var firstError = null;\n  if (options && options.error) {\n    firstError = options.error;\n  }\n\n  if (!numPosts) {\n    return process.nextTick(function() {\n      callback.apply(null, [firstError].concat(args));\n    });\n  }\n\n  var next = function() {\n    var post = posts[currentPost];\n    var numArgs = 0;\n    var argLength = args.length;\n    var newArgs = [];\n    for (var i = 0; i < argLength; ++i) {\n      numArgs += args[i] && args[i]._kareemIgnore ? 0 : 1;\n      if (!args[i] || !args[i]._kareemIgnore) {\n        newArgs.push(args[i]);\n      }\n    }\n\n    if (firstError) {\n      if (post.length === numArgs + 2) {\n        post.apply(context, [firstError].concat(newArgs).concat(function(error) {\n          if (error) {\n            firstError = error;\n          }\n          if (++currentPost >= numPosts) {\n            return callback.call(null, firstError);\n          }\n          next();\n        }));\n      } else {\n        if (++currentPost >= numPosts) {\n          return callback.call(null, firstError);\n        }\n        next();\n      }\n    } else {\n      if (post.length === numArgs + 2) {\n        // Skip error handlers if no error\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n        return next();\n      }\n      if (post.length === numArgs + 1) {\n        post.apply(context, newArgs.concat(function(error) {\n          if (error) {\n            firstError = error;\n            return next();\n          }\n\n          if (++currentPost >= numPosts) {\n            return callback.apply(null, [null].concat(args));\n          }\n\n          next();\n        }));\n      } else {\n        post.apply(context, newArgs);\n\n        if (++currentPost >= numPosts) {\n          return callback.apply(null, [null].concat(args));\n        }\n\n        next();\n      }\n    }\n  };\n\n  next();\n};\n\nKareem.prototype.execPostSync = function(name, context) {\n  var posts = this._posts[name] || [];\n  var numPosts = posts.length;\n\n  for (var i = 0; i < numPosts; ++i) {\n    posts[i].call(context);\n  }\n};\n\nfunction _handleWrapError(instance, error, name, context, args, options, callback) {\n  if (options.useErrorHandlers) {\n    var _options = { error: error };\n    return instance.execPost(name, context, args, _options, function(error) {\n      return typeof callback === 'function' && callback(error);\n    });\n  } else {\n    return typeof callback === 'function' ?\n      callback(error) :\n      undefined;\n  }\n}\n\nKareem.prototype.wrap = function(name, fn, context, args, options) {\n  var lastArg = (args.length > 0 ? args[args.length - 1] : null);\n  var argsWithoutCb = typeof lastArg === 'function' ?\n    args.slice(0, args.length - 1) :\n    args;\n  var _this = this;\n\n  var useLegacyPost;\n  if (typeof options === 'object') {\n    useLegacyPost = options && options.useLegacyPost;\n  } else {\n    useLegacyPost = options;\n  }\n  options = options || {};\n\n  this.execPre(name, context, args, function(error) {\n    if (error) {\n      var numCallbackParams = options.numCallbackParams || 0;\n      var nulls = [];\n      for (var i = 0; i < numCallbackParams; ++i) {\n        nulls.push(null);\n      }\n      return _handleWrapError(_this, error, name, context, nulls,\n        options, lastArg);\n    }\n\n    var end = (typeof lastArg === 'function' ? args.length - 1 : args.length);\n\n    fn.apply(context, args.slice(0, end).concat(function() {\n      var args = arguments;\n      var argsWithoutError = Array.prototype.slice.call(arguments, 1);\n      if (options.nullResultByDefault && argsWithoutError.length === 0) {\n        argsWithoutError.push(null);\n      }\n      if (arguments[0]) {\n        // Assume error\n        return _handleWrapError(_this, arguments[0], name, context,\n          argsWithoutError, options, lastArg);\n      } else {\n        if (useLegacyPost && typeof lastArg === 'function') {\n          lastArg.apply(context, arguments);\n        }\n\n        _this.execPost(name, context, argsWithoutError, function() {\n          if (arguments[0]) {\n            return typeof lastArg === 'function' ?\n              lastArg(arguments[0]) :\n              undefined;\n          }\n\n          return typeof lastArg === 'function' && !useLegacyPost ?\n            lastArg.apply(context, arguments) :\n            undefined;\n        });\n      }\n    }));\n  });\n};\n\nKareem.prototype.createWrapper = function(name, fn, context, options) {\n  var _this = this;\n  return function() {\n    var args = Array.prototype.slice.call(arguments);\n    _this.wrap(name, fn, context, args, options);\n  };\n};\n\nKareem.prototype.pre = function(name, isAsync, fn, error) {\n  if (typeof arguments[1] !== 'boolean') {\n    error = fn;\n    fn = isAsync;\n    isAsync = false;\n  }\n\n  this._pres[name] = this._pres[name] || [];\n  var pres = this._pres[name];\n\n  if (isAsync) {\n    pres.numAsync = pres.numAsync || 0;\n    ++pres.numAsync;\n  }\n\n  pres.push({ fn: fn, isAsync: isAsync });\n\n  return this;\n};\n\nKareem.prototype.post = function(name, fn) {\n  (this._posts[name] = this._posts[name] || []).push(fn);\n  return this;\n};\n\nKareem.prototype.clone = function() {\n  var n = new Kareem();\n  for (var key in this._pres) {\n    if (!this._pres.hasOwnProperty(key)) {\n      continue;\n    }\n    n._pres[key] = this._pres[key].slice();\n    n._pres[key].numAsync = this._pres[key].numAsync;\n  }\n  for (var key in this._posts) {\n    if (!this._posts.hasOwnProperty(key)) {\n      continue;\n    }\n    n._posts[key] = this._posts[key].slice();\n  }\n\n  return n;\n};\n\nKareem.prototype.merge = function(other) {\n  var ret = this.clone();\n  for (var key in other._pres) {\n    if (!other._pres.hasOwnProperty(key)) {\n      continue;\n    }\n    ret._pres[key] = (ret._pres[key] || []).concat(other._pres[key].slice());\n    ret._pres[key].numAsync += other._pres[key].numAsync;\n  }\n  for (var key in other._posts) {\n    if (!other._posts.hasOwnProperty(key)) {\n      continue;\n    }\n    ret._posts[key] = (ret._posts[key] || []).concat(other._posts[key].slice());\n  }\n\n  return ret;\n};\n\nmodule.exports = Kareem;\n"]},"metadata":{},"sourceType":"script"}